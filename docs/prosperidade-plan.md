# PLANO PROSPERIDADE - Genesis OS
## Elevando ao NÃ­vel das Melhores Plataformas de Healthcare dos EUA

---

## âš ï¸ DEFINIÃ‡ÃƒO DO PRODUTO - LEIA PRIMEIRO

### O QUE Ã‰ O GENESIS OS

> **Genesis OS Ã© uma PLATAFORMA SaaS (Software as a Service) de gestÃ£o para clÃ­nicas mÃ©dicas e centros de apoio diagnÃ³stico.**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ARQUITETURA DO NEGÃ“CIO                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    GENESIS OS (NÃ“S)                              â”‚   â”‚
â”‚   â”‚         Plataforma SaaS Multi-Tenant de Healthcare               â”‚   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â”‚  â€¢ Fornecemos a infraestrutura e o software                     â”‚   â”‚
â”‚   â”‚  â€¢ Mantemos e evoluÃ­mos a plataforma                            â”‚   â”‚
â”‚   â”‚  â€¢ Garantimos seguranÃ§a, compliance e uptime                    â”‚   â”‚
â”‚   â”‚  â€¢ NÃƒO somos uma clÃ­nica, NÃƒO atendemos pacientes               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              CLÃNICAS CLIENTES (TENANTS)                         â”‚   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚   â”‚  â”‚  ClÃ­nica A   â”‚  â”‚  ClÃ­nica B   â”‚  â”‚  ClÃ­nica C   â”‚  ...      â”‚   â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚           â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Seu CNES   â”‚  â”‚ â€¢ Seu CNES   â”‚  â”‚ â€¢ Seu CNES   â”‚           â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Seu CNPJ   â”‚  â”‚ â€¢ Seu CNPJ   â”‚  â”‚ â€¢ Seu CNPJ   â”‚           â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Seu e-CNPJ â”‚  â”‚ â€¢ Seu e-CNPJ â”‚  â”‚ â€¢ Seu e-CNPJ â”‚           â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ ConvÃªnios  â”‚  â”‚ â€¢ ConvÃªnios  â”‚  â”‚ â€¢ ConvÃªnios  â”‚           â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Pacientes  â”‚  â”‚ â€¢ Pacientes  â”‚  â”‚ â€¢ Pacientes  â”‚           â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### O QUE CADA CLÃNICA CLIENTE FAZ (NÃƒO NÃ“S)

| Responsabilidade | Quem Faz | Onde no Sistema |
|------------------|----------|-----------------|
| Obter CNES | A clÃ­nica | DATASUS |
| Ter CNPJ ativo | A clÃ­nica | Receita Federal |
| Comprar certificado e-CNPJ | A clÃ­nica | Certisign, Serasa, etc. |
| **Upload do certificado** | A clÃ­nica | Settings â†’ ConvÃªnios |
| Credenciar-se com operadoras | A clÃ­nica | Cada operadora |
| Cadastrar operadoras no sistema | A clÃ­nica | Settings â†’ ConvÃªnios |
| Criar guias TISS | A clÃ­nica | Faturamento |
| Gerenciar glosas | A clÃ­nica | Faturamento â†’ Glosas |

### O QUE NÃ“S (GENESIS OS) FORNECEMOS

| Funcionalidade | DescriÃ§Ã£o |
|----------------|-----------|
| Interface para upload de certificado | UI segura para a clÃ­nica subir seu .pfx |
| Armazenamento criptografado | Guardamos o certificado com seguranÃ§a |
| GeraÃ§Ã£o de XML TISS | Geramos XML no padrÃ£o ANS 4.02.00 |
| Assinatura digital | Assinamos XML com o certificado DA CLÃNICA |
| Envio para operadoras | Enviamos via WebService usando credenciais DA CLÃNICA |
| GestÃ£o de guias | CRUD completo de guias para A CLÃNICA |
| RelatÃ³rios | Analytics do faturamento DA CLÃNICA |

---

## BENCHMARK: O QUE AS MELHORES FAZEM

### Plataformas Analisadas
| Plataforma | Foco | Destaques UX |
|------------|------|--------------|
| **Epic MyChart** | Portal do paciente | Score KLAS 90.2, informaÃ§Ã£o priorizada, acessibilidade total |
| **SimplePractice** | Mental health | AI Notes (-50% tempo), mobile-first, HIPAA |
| **Jane App** | ClÃ­nicas wellness | Self-booking, AI Scribe, wait list management |
| **Klara** | ComunicaÃ§Ã£o | 80%+ adoption, sem login/senha para paciente |
| **Elation Health** | Primary care | Three-panel console, Note Assist ambient AI |
| **DrChrono** | Mobile EHR | iPad-native, #1 Mobile EHR 9 anos seguidos |
| **Carbon Health** | ClÃ­nicas | AI charting em <4min vs 16min manual |
| **Zocdoc** | Booking | Card-based design, cores vibrantes, ML search |
| **Healthie** | NutriÃ§Ã£o | Goals tracking, wearable integration |
| **athenahealth** | EHR enterprise | 170+ features Summer 2025, Executive Summary |

---

## PRINCÃPIOS EXTRAÃDOS (O QUE COPIAR)

### 1. **"No matter how much power, it needs to be EASY"** - Epic
- InformaÃ§Ã£o priorizada: crÃ­tico no topo, secundÃ¡rio ao scroll
- Zero cognitive load para aÃ§Ãµes principais
- 3 taps mÃ¡ximo para qualquer aÃ§Ã£o core

### 2. **PersonalizaÃ§Ã£o DinÃ¢mica**
- Dashboard adapta ao tipo de usuÃ¡rio (mÃ©dico vs admin vs nutricionista)
- MyChart customiza baseado no histÃ³rico de saÃºde do paciente
- Klara roteia automaticamente com AI

### 3. **AI Ambient Documentation**
- Carbon Health: 88% do texto AI aceito sem ediÃ§Ã£o
- Elation Note Assist: gera durante a consulta, nÃ£o depois
- Abridge: Best in KLAS 2025 para ambient scribes

### 4. **Zero Friction Communication**
- Klara: Paciente nÃ£o precisa de login, senha ou app
- Multi-canal: SMS, email, portal, WhatsApp
- Lembretes reduzem no-shows em 30-60%

### 5. **Linear Design Philosophy**
- Monochrome com poucos bold colors
- Densidade alta de informaÃ§Ã£o, ruÃ­do visual baixo
- Dark mode inteligente baseado em contexto

---

## GAPS CRÃTICOS NO GENESIS OS

| O que falta | ReferÃªncia | Impacto |
|-------------|------------|---------|
| KPIs dinÃ¢micos | athenahealth Executive Summary | Alto |
| AI Scribe jÃ¡ existe mas UI Ã© bÃ¡sica | Elation Note Assist | Alto |
| PÃ¡gina /help vazia | Todas tÃªm Help Center | Alto |
| Wait list management | Jane App | MÃ©dio |
| Patient self-booking pÃºblico | Zocdoc, Jane | Alto |
| Financial wellness dashboard | Healthie | MÃ©dio |
| Multi-channel notifications | Klara, Epic | Alto |
| Onboarding progressivo | Oscar Health | Alto |

---

## PLANO DE IMPLEMENTAÃ‡ÃƒO

### FASE 1: FUNDAÃ‡ÃƒO PREMIUM (Sprint 1) âœ… COMPLETO
**Objetivo:** Estabelecer a base de qualidade visual e funcional
**Status:** Implementado em 22/12/2024

**Entregas:**
- [x] Dashboard com KPIs dinÃ¢micos e comparaÃ§Ã£o temporal
- [x] Help Center completo (FAQ, artigos searchable, contato)
- [x] useDashboardMetrics hook para mÃ©tricas calculadas
- [x] KPICard e OccupancyGauge components
- [x] Skeleton loading e empty states

#### 1.1 Dashboard Inteligente
**InspiraÃ§Ã£o:** athenahealth Executive Summary, Elation three-panel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [SaudaÃ§Ã£o contextual]          [PerÃ­odo â–¼] [RelatÃ³rio]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Consultasâ”‚ â”‚ Pacientesâ”‚ â”‚Faturamentoâ”‚ â”‚ OcupaÃ§Ã£o â”‚       â”‚
â”‚  â”‚   HOJE   â”‚ â”‚  ATIVOS  â”‚ â”‚   MÃŠS    â”‚ â”‚  REAL   â”‚       â”‚
â”‚  â”‚    8     â”‚ â”‚   247    â”‚ â”‚ R$42.5k  â”‚ â”‚   78%   â”‚       â”‚
â”‚  â”‚  +2 vs   â”‚ â”‚  +12 vs  â”‚ â”‚ +15% vs  â”‚ â”‚ Meta:85%â”‚       â”‚
â”‚  â”‚  ontem   â”‚ â”‚ mÃªs ant. â”‚ â”‚ mÃªs ant. â”‚ â”‚         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   PRÃ“XIMAS CONSULTAS    â”‚  â”‚    TAREFAS URGENTES     â”‚  â”‚
â”‚  â”‚   [Timeline visual]     â”‚  â”‚    [Priority list]      â”‚  â”‚
â”‚  â”‚   08:30 Maria Silva     â”‚  â”‚    ğŸ”´ Finalizar prontuÃ¡rio â”‚
â”‚  â”‚   09:00 JoÃ£o Santos     â”‚  â”‚    ğŸŸ¡ Confirmar agenda    â”‚
â”‚  â”‚   09:30 Ana Oliveira    â”‚  â”‚    âšª Enviar resultados   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Arquivos:**
- `/src/pages/Dashboard.tsx` - Refatorar KPIs para dados reais
- `/src/hooks/useDashboardMetrics.ts` - NOVO: hook para mÃ©tricas calculadas
- `/src/components/dashboard/KPICard.tsx` - Adicionar comparaÃ§Ã£o temporal
- `/src/components/dashboard/OccupancyGauge.tsx` - NOVO: gauge visual

**MÃ©tricas a calcular:**
- Taxa de ocupaÃ§Ã£o REAL = (consultas agendadas / slots disponÃ­veis) Ã— 100
- ComparaÃ§Ã£o com perÃ­odo anterior (dia, semana, mÃªs)
- Trend indicators (â†‘ â†“ â†’)

#### 1.2 Help Center Completo
**InspiraÃ§Ã£o:** Intercom, Zendesk, SimplePractice

**Arquivos:**
- `/src/pages/Help.tsx` - NOVO: pÃ¡gina completa
- `/src/components/help/SearchableArticles.tsx` - Busca em artigos
- `/src/components/help/ContactSupport.tsx` - FormulÃ¡rio de contato
- `/src/components/help/FAQAccordion.tsx` - Perguntas frequentes

**ConteÃºdo obrigatÃ³rio:**
- Quick Start Guide
- Guia de Agendamento
- Guia de ProntuÃ¡rio
- Guia Financeiro
- TISS e Faturamento
- ConfiguraÃ§Ãµes da Conta
- Contato/Suporte

---

### FASE 2: EXPERIÃŠNCIA DO PACIENTE (Sprint 2) âœ… COMPLETO
**Objetivo:** Self-service para pacientes
**Status:** Implementado em 22/12/2024

**Entregas:**
- [x] BookAppointment.tsx - Wizard de 4 etapas estilo Zocdoc
- [x] ClinicProfile.tsx - PÃ¡gina pÃºblica da clÃ­nica
- [x] AvailabilityCalendar.tsx - CalendÃ¡rio de disponibilidade
- [x] ProfessionalSelector.tsx - SeleÃ§Ã£o de profissional
- [x] BookingComponents.tsx - Componentes reutilizÃ¡veis
- [x] NotificationPreferences.tsx - PreferÃªncias multi-canal (WhatsApp, SMS, Email, Push)
- [x] Aba NotificaÃ§Ãµes integrada no Settings.tsx

#### 2.1 Portal do Paciente (PÃºblico)
**InspiraÃ§Ã£o:** Zocdoc, Jane App, Epic MyChart

**Features:**
- [x] Agendamento pÃºblico sem login
- [x] Escolha de profissional
- [x] VisualizaÃ§Ã£o de horÃ¡rios disponÃ­veis
- [ ] ConfirmaÃ§Ã£o por SMS/Email (backend pendente)
- [ ] Check-in digital prÃ©-consulta (futuro)

**Arquivos:**
- `/src/pages/public/BookAppointment.tsx` - âœ… CRIADO
- `/src/pages/public/ClinicProfile.tsx` - âœ… CRIADO
- `/src/components/booking/AvailabilityCalendar.tsx` - âœ… CRIADO
- `/src/components/booking/ProfessionalSelector.tsx` - âœ… CRIADO

#### 2.2 Sistema de NotificaÃ§Ãµes Multi-canal
**InspiraÃ§Ã£o:** Klara (80%+ adoption), Curogram

**Fluxo de lembretes:**
```
7 dias antes  â†’  Email com instruÃ§Ãµes de preparo
24h antes     â†’  SMS confirmaÃ§Ã£o (resposta Y/N)
2h antes      â†’  Push notification (se app instalado)
```

**Arquivos:**
- `/src/services/notification.service.ts` - PENDENTE (backend)
- `/src/components/notifications/NotificationPreferences.tsx` - âœ… CRIADO
- `/functions/src/triggers/appointmentReminders.ts` - Cloud Function

---

### FASE 3: DOCUMENTAÃ‡ÃƒO INTELIGENTE (Sprint 3) âœ… COMPLETO
**Objetivo:** AI-powered documentation
**Status:** Implementado em 22/12/2024

**Entregas:**
- [x] RecordingControls.tsx - UI premium com waveform animado e ProcessingIndicator
- [x] CID10Suggestions.tsx - 70+ cÃ³digos CID-10, busca e sugestÃµes por keywords
- [x] SpecialtyTemplates.tsx - 6 especialidades mÃ©dicas com preview
- [x] SOAPReview.tsx - Quick Accept/Reject por seÃ§Ã£o com barra de progresso
- [x] SoapEditor.tsx - IntegraÃ§Ã£o completa de templates e AI Scribe

#### 3.1 AI Scribe Enhancement
**InspiraÃ§Ã£o:** Elation Note Assist, Carbon Health, Abridge

**Melhorias no sistema existente:**
- [x] UI de gravaÃ§Ã£o mais proeminente (waveform visual, cores por estado)
- [x] Feedback visual durante transcriÃ§Ã£o (ProcessingIndicator com 3 steps)
- [x] SugestÃµes de cÃ³digo CID-10 (70+ cÃ³digos, busca autocomplete, AI suggestions)
- [x] Templates por especialidade (6 especialidades: ClÃ­nica Geral, Cardiologia, Neurologia, Pediatria, Endocrinologia, NutriÃ§Ã£o)
- [x] Aceitar/rejeitar com um clique (per-section status: pending/accepted/edited)

**Arquivos:**
- `/src/components/ai/RecordingControls.tsx` - âœ… UI PREMIUM
- `/src/components/ai/CID10Suggestions.tsx` - âœ… CRIADO
- `/src/components/ai/SpecialtyTemplates.tsx` - âœ… CRIADO
- `/src/components/ai/SOAPReview.tsx` - âœ… APRIMORADO
- `/src/plugins/medicina/SoapEditor.tsx` - âœ… INTEGRADO

#### 3.2 SOAP Notes Premium
**InspiraÃ§Ã£o:** Practice Fusion, CharmHealth

**Features:**
- [x] Templates customizÃ¡veis por procedimento (6 especialidades)
- [ ] Macros de texto (atalhos) - FUTURO
- [ ] Auto-populate de dados vitais - FUTURO
- [ ] HistÃ³rico de alteraÃ§Ãµes - FUTURO
- [ ] Assinatura digital - FUTURO

---

### FASE 4: DESIGN SYSTEM PREMIUM (Sprint 4) âœ… COMPLETO
**Objetivo:** ConsistÃªncia visual de nÃ­vel Linear/Stripe
**Status:** Implementado em 22/12/2024

**Entregas:**
- [x] Micro-interaÃ§Ãµes premium (hover lift, active scale, focus ring)
- [x] Card premium com shadow transitions
- [x] Button com micro-animaÃ§Ãµes (scale, translate-y)
- [x] Progress components (ProgressBar, ProgressCircular, LoadingDots, LoadingSpinner, StepProgress)
- [x] EmptyState com ilustraÃ§Ãµes SVG animadas (6 tipos)
- [x] Skeleton loading com shimmer animation
- [x] Glass morphism, glow effects, gradient borders
- [x] Stagger animations para listas

#### 4.1 Micro-interaÃ§Ãµes âœ…
**InspiraÃ§Ã£o:** Linear, Stripe

**Implementado em `index.css`:**
```css
/* Hover premium - jÃ¡ no Button.tsx e Card.tsx */
.card-premium { hover:translateY(-2px), shadow-lg }
.interactive { hover:translateY(-1px), active:scale(0.98) }
.focus-ring { focus-visible:ring-2 ring-offset-2 }
.glow-primary { hover:shadow com cor primÃ¡ria }
```

**Componentes atualizados:**
- `Button.tsx`: hover:scale-[1.02], active:scale-[0.98], translateY
- `Card.tsx`: interactive mode com hover lift e focus ring

#### 4.2 Loading States Premium âœ…
**InspiraÃ§Ã£o:** Carbon Design System

**Novo componente: `/src/design-system/components/Progress.tsx`**
- [x] ProgressBar - linear com valor ou indeterminate
- [x] ProgressCircular - circular com SVG animado
- [x] LoadingDots - dots bouncing
- [x] LoadingSpinner - spinner SVG
- [x] StepProgress - steps de wizard com checkmarks

**Existentes:**
- [x] Skeleton.tsx com shimmer animation (jÃ¡ implementado)

#### 4.3 Empty States com Personalidade âœ…
**InspiraÃ§Ã£o:** Mailchimp, Notion

**JÃ¡ implementado: `/src/components/ui/EmptyState.tsx`**
- [x] 6 ilustraÃ§Ãµes SVG minimalistas (documents, search, success, calendar, patients, inbox)
- [x] TÃ­tulo empÃ¡tico configurÃ¡vel
- [x] DescriÃ§Ã£o Ãºtil
- [x] CTA com aÃ§Ã£o
- [x] AnimaÃ§Ã£o float sutil

---

### FASE 5: INTELIGÃŠNCIA E ANALYTICS (Sprint 5) âœ… COMPLETO
**Objetivo:** Insights acionÃ¡veis
**Status:** Implementado em 22/12/2024

**Entregas:**
- [x] useFinancialWellness hook - mÃ©tricas financeiras avanÃ§adas
- [x] usePatientInsights hook - retenÃ§Ã£o, NPS, engajamento
- [x] FinancialWellness component - dashboard visual premium
- [x] PatientInsights component - insights de pacientes
- [x] Analytics page - pÃ¡gina unificada com tabs
- [x] Rota /analytics configurada + link no Sidebar

#### 5.1 Financial Wellness Dashboard âœ…
**InspiraÃ§Ã£o:** Healthie, athenahealth

**MÃ©tricas implementadas:**
- [x] Health Score financeiro (0-100) com breakdown
- [x] Ticket mÃ©dio por procedimento com ranking
- [x] Taxa de inadimplÃªncia com aging (1-30d, 31-60d, 61-90d, 90+d)
- [x] ProjeÃ§Ã£o de receita (mensal, trimestral, anual)
- [x] Comparativo YoY com trend indicators
- [x] RecomendaÃ§Ãµes automÃ¡ticas baseadas nos dados

**Arquivos:**
- `/src/hooks/useFinancialWellness.ts` - Hook de mÃ©tricas
- `/src/components/analytics/FinancialWellness.tsx` - Componente visual

#### 5.2 Patient Insights âœ…
**InspiraÃ§Ã£o:** Epic MyChart Central

**MÃ©tricas implementadas:**
- [x] Taxa de retorno de pacientes
- [x] NPS automatizado com promoters/passives/detractors
- [x] Alertas de pacientes em risco (no_return, missed_appointments)
- [x] MÃ©tricas de engajamento (confirmaÃ§Ã£o, no-show, canais)
- [x] Demographics (idade, gÃªnero, convÃªnio)
- [x] Feedback recente

**Arquivos:**
- `/src/hooks/usePatientInsights.ts` - Hook de mÃ©tricas
- `/src/components/analytics/PatientInsights.tsx` - Componente visual
- `/src/pages/Analytics.tsx` - PÃ¡gina unificada

---

## CHECKLIST DE QUALIDADE

### Antes de cada deploy:
- [ ] WCAG 2.1 AA compliance
- [ ] Dark mode testado em TODAS as telas
- [ ] Mobile responsivo testado
- [ ] Loading states em todas as aÃ§Ãµes async
- [ ] Error states com recovery path
- [ ] Empty states informativos
- [ ] Keyboard navigation funcional
- [ ] Screen reader testado

### PadrÃµes de cÃ³digo:
- [ ] Nenhum `bg-white` ou `text-gray-*` hardcoded
- [ ] Todos os tokens do design system
- [ ] Nenhum `console.log` em produÃ§Ã£o
- [ ] Nenhum `alert()` - usar toast
- [ ] TypeScript strict mode

---

### FASE 6: WHATSAPP BUSINESS API - JÃ IMPLEMENTADO!
**Status:** 100% do cÃ³digo pronto, falta apenas configuraÃ§Ã£o/deploy

#### 6.1 O que JÃ EXISTE:
| Arquivo | Funcionalidade |
|---------|----------------|
| `functions/src/whatsapp/client.ts` | WhatsApp Cloud API v21.0 - sendTemplateMessage, sendTextMessage, markAsRead |
| `functions/src/whatsapp/templates.ts` | 3 templates: consulta_lembrete_24h, consulta_lembrete_2h, consulta_confirmacao |
| `functions/src/whatsapp/webhook.ts` | Webhook completo - verificaÃ§Ã£o Meta, processamento de respostas, atualizaÃ§Ã£o automÃ¡tica |
| `functions/src/scheduler/reminders.ts` | Schedulers: sendReminders24h (every 1h), sendReminders2h (every 30min) |
| `functions/src/scheduler/triggers.ts` | Triggers: onAppointmentCreated, onAppointmentUpdated |

#### 6.2 O que FALTA (apenas configuraÃ§Ã£o):
```bash
# 1. Configurar secrets no Firebase:
firebase functions:secrets:set WHATSAPP_TOKEN
firebase functions:secrets:set WHATSAPP_PHONE_NUMBER_ID
firebase functions:secrets:set WHATSAPP_VERIFY_TOKEN

# 2. Deploy das functions:
cd functions && npm run deploy

# 3. Configurar Webhook URL no Meta Business:
# https://[project-id].cloudfunctions.net/whatsappWebhook
```

**Templates no cÃ³digo (precisam estar aprovados no Meta):**
- [x] `consulta_confirmacao` - ConfirmaÃ§Ã£o ao agendar
- [x] `consulta_lembrete_24h` - Lembrete 24h antes
- [x] `consulta_lembrete_2h` - Lembrete 2h antes

---

### FASE 7: PORTAL DO PACIENTE COMPLETO (Sprint 7-8)
**Objetivo:** Self-service completo para pacientes

#### 7.1 AutenticaÃ§Ã£o Segura
**InspiraÃ§Ã£o:** Epic MyChart, SMART on FHIR

**Stack:**
- Firebase Auth (jÃ¡ configurado)
- OAuth 2.0 para apps terceiros
- Magic Link (sem senha)
- Biometric login (mobile)

**Arquivos:**
- `/src/pages/patient-portal/Login.tsx` - Login paciente
- `/src/pages/patient-portal/MagicLink.tsx` - Link mÃ¡gico
- `/src/contexts/PatientAuthContext.tsx` - Auth separado

#### 7.2 Features do Portal
**InspiraÃ§Ã£o:** MyChart (90.2 KLAS), OnPatient

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PORTAL DO PACIENTE - ClÃ­nica Genesis                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  OlÃ¡, Maria! Sua prÃ³xima consulta Ã© em 3 dias.       â”‚  â”‚
â”‚  â”‚  [Ver Detalhes]  [Reagendar]                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Consultas  â”‚  â”‚  HistÃ³rico  â”‚  â”‚  Receitas   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Exames     â”‚  â”‚  Mensagens  â”‚  â”‚  Financeiro â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Funcionalidades:**
- [ ] Dashboard personalizado
- [ ] HistÃ³rico de consultas
- [ ] Resultados de exames (PDF/visualizaÃ§Ã£o)
- [ ] Receitas e prescriÃ§Ãµes
- [ ] Mensagens seguras com mÃ©dico
- [ ] Agendamento online
- [ ] Pagamentos e faturas
- [ ] Teleconsulta integrada
- [ ] Dependentes (filhos/idosos)

**Arquivos:**
- `/src/pages/patient-portal/Dashboard.tsx`
- `/src/pages/patient-portal/Appointments.tsx`
- `/src/pages/patient-portal/MedicalRecords.tsx`
- `/src/pages/patient-portal/LabResults.tsx`
- `/src/pages/patient-portal/Prescriptions.tsx`
- `/src/pages/patient-portal/Messages.tsx`
- `/src/pages/patient-portal/Billing.tsx`
- `/src/pages/patient-portal/Telehealth.tsx`

---

### FASE 8: CONVÃŠNIOS E TISS - PESQUISA âœ… COMPLETO
**Objetivo:** Pesquisa completa da legislaÃ§Ã£o e requisitos tÃ©cnicos
**Status:** âœ… PESQUISA CONCLUÃDA (22/12/2024)
**Documento:** `docs/research/CONVENIOS_TISS_RESEARCH.md` (920+ linhas)

#### 8.1 Resumo da Pesquisa Realizada

**LegislaÃ§Ã£o:**
- [x] RN 501/2022 - PadrÃ£o TISS obrigatÃ³rio
- [x] VersÃ£o atual: TISS 4.01.00 (vigente)
- [x] Multas: R$ 5.000 a R$ 1.000.000
- [x] TUSS atualizaÃ§Ã£o Jan/2025 disponÃ­vel

**Operadoras Pesquisadas (7):**
| Operadora | Tipo | Portal/WebService |
|-----------|------|-------------------|
| UNIMED | Cooperativa | WSD-TISS + Portal regional |
| GEAP | AutogestÃ£o Federal | Sistema TMS + AI |
| CASSI | AutogestÃ£o (BB) | AFR + Biometria |
| Postal SaÃºde | AutogestÃ£o (Correios) | Benner CONECTA |
| Amil | Medicina de Grupo | Portal SIS + WebService |
| Bradesco | Seguradora | Portal Referenciado |
| SulAmÃ©rica | Seguradora | WebService + RGE |

**CertificaÃ§Ã£o Digital:**
- [x] ObrigatÃ³rio: e-CNPJ ou e-CPF ICP-Brasil
- [x] Tipo A1 (arquivo) recomendado para integraÃ§Ã£o
- [x] XMLDSig para assinatura

---

### FASE 8b: CONVÃŠNIOS E TISS - IMPLEMENTAÃ‡ÃƒO âœ… COMPLETO
**Objetivo:** MÃ³dulo completo de faturamento TISS para clÃ­nicas (multi-tenant)
**Status:** âœ… COMPLETO (23/12/2024)

> âš ï¸ **LEMBRETE CRÃTICO: NÃ“S SOMOS O PROVEDOR DA PLATAFORMA**
>
> Genesis OS Ã© um **SaaS multi-tenant**. NÃ³s **NÃƒO** somos uma clÃ­nica.
>
> **O que NÃ“S fazemos:**
> - Criamos as INTERFACES para as clÃ­nicas configurarem seus dados
> - Fornecemos a INFRAESTRUTURA para upload seguro de certificados
> - Implementamos a LÃ“GICA de geraÃ§Ã£o de XML TISS
> - Criamos as TELAS de gestÃ£o de guias, lotes e glosas
>
> **O que CADA CLÃNICA CLIENTE faz (usando nossa plataforma):**
> - Faz upload do SEU certificado e-CNPJ (que ELA comprou)
> - Cadastra SUAS operadoras/convÃªnios (que ELA tem contrato)
> - Cria SUAS guias TISS (para SEUS pacientes)
> - Gerencia SUAS glosas (das SUAS guias)

#### 8b.1 Arquitetura Multi-Tenant para ConvÃªnios

```
Genesis OS (SaaS)
â”‚
â”œâ”€â”€ /clinics/{clinicId}
â”‚   â”œâ”€â”€ settings.convenios              # Config geral de convÃªnios
â”‚   â”‚   â”œâ”€â”€ cnes: string                # CNES da clÃ­nica
â”‚   â”‚   â”œâ”€â”€ cnpj: string                # CNPJ da clÃ­nica
â”‚   â”‚   â””â”€â”€ certificadoDigital: {       # Certificado ICP-Brasil
â”‚   â”‚       â”œâ”€â”€ base64: string (encrypted)
â”‚   â”‚       â”œâ”€â”€ senha: string (encrypted)
â”‚   â”‚       â”œâ”€â”€ validade: timestamp
â”‚   â”‚       â””â”€â”€ tipo: 'A1' | 'A3'
â”‚   â”‚       }
â”‚   â”‚
â”‚   â”œâ”€â”€ /operadoras/{operadoraId}       # ConvÃªnios credenciados
â”‚   â”‚   â”œâ”€â”€ registroANS: string
â”‚   â”‚   â”œâ”€â”€ nomeFantasia: string
â”‚   â”‚   â”œâ”€â”€ codigoPrestador: string     # CÃ³digo NA operadora
â”‚   â”‚   â”œâ”€â”€ webservice: {
â”‚   â”‚   â”‚   â”œâ”€â”€ url: string
â”‚   â”‚   â”‚   â”œâ”€â”€ usuario: string (encrypted)
â”‚   â”‚   â”‚   â”œâ”€â”€ senha: string (encrypted)
â”‚   â”‚   â”‚   â””â”€â”€ versaoTISS: string
â”‚   â”‚   â”‚   }
â”‚   â”‚   â”œâ”€â”€ tabelaPrecos: 'TUSS' | 'CBHPM' | 'propria'
â”‚   â”‚   â””â”€â”€ ativa: boolean
â”‚   â”‚
â”‚   â”œâ”€â”€ /guias/{guiaId}                 # Guias TISS (jÃ¡ existe)
â”‚   â”‚
â”‚   â”œâ”€â”€ /lotes/{loteId}                 # Lotes de envio
â”‚   â”‚   â”œâ”€â”€ guiaIds: string[]
â”‚   â”‚   â”œâ”€â”€ operadoraId: string
â”‚   â”‚   â”œâ”€â”€ status: 'pendente' | 'enviado' | 'processado' | 'erro'
â”‚   â”‚   â”œâ”€â”€ xmlEnvio: string
â”‚   â”‚   â”œâ”€â”€ xmlResposta: string
â”‚   â”‚   â”œâ”€â”€ protocolo: string
â”‚   â”‚   â””â”€â”€ dataEnvio: timestamp
â”‚   â”‚
â”‚   â””â”€â”€ /glosas/{glosaId}               # Glosas recebidas (jÃ¡ existe)
```

#### 8b.2 Checklist de ImplementaÃ§Ã£o

**ETAPA 1: Infraestrutura Base** âœ…
- [x] **1.1** Criar collection `operadoras` no Firestore
- [x] **1.2** Adicionar `settings.convenios` ao tipo Clinic (ClinicConvenioSettings)
- [x] **1.3** Criar `operadora.service.ts` (CRUD operadoras por clÃ­nica)
- [x] **1.4** Criar `useOperadoras()` hook
- [x] **1.5** Criar collection `guias` com `guia.service.ts`
- [x] **1.6** Expandir `tiss.types.ts` com Lote, WebServiceConfig (refatorado em mÃ³dulos)

**ETAPA 2: ConfiguraÃ§Ã£o da ClÃ­nica (Settings)** âœ…
> *Interfaces para que A CLÃNICA CLIENTE configure seus dados*
- [x] **2.1** Criar tab "ConvÃªnios" em Settings
- [x] **2.2** Form para clÃ­nica inserir dados cadastrais (CNES, CNPJ)
- [x] **2.3** Componente `CertificadoUpload.tsx` - UI para clÃ­nica subir SEU .pfx/.p12 (refatorado: 336 linhas + CertificateDisplay + certificate-utils)
- [ ] **2.4** Cloud Function para validar e armazenar certificado DA CLÃNICA (criptografado)
- [x] **2.5** Lista de operadoras credenciadas (CRUD para a clÃ­nica gerenciar)
- [x] **2.6** Form de nova operadora (OperadoraForm.tsx) - clÃ­nica cadastra SEUS convÃªnios

**ETAPA 3: CriaÃ§Ã£o de Guias** âœ…
> *Interfaces para que A CLÃNICA crie guias para SEUS pacientes*
- [x] **3.1** Criar `useGuias()` hook (CRUD + real-time + stats)
- [x] **3.2** Completar integraÃ§Ã£o `TissConsultaForm` â†’ Firestore (refatorado: 466 linhas)
- [x] **3.3** Criar `TissSADTForm` para guias SP/SADT (refatorado: 459 linhas + ProcedimentoItem.tsx)
- [x] **3.4** Seletor de operadora no form (filtra por clÃ­nica)
- [x] **3.5** Autocomplete de cÃ³digo TUSS (jÃ¡ existe base)
- [ ] **3.6** ValidaÃ§Ã£o XSD antes de salvar (nÃ³s validamos, clÃ­nica corrige se necessÃ¡rio)
- [ ] **3.7** Preview XML gerado (clÃ­nica pode revisar antes de enviar)

**ETAPA 4: GestÃ£o de Guias** âœ…
> *Telas para A CLÃNICA gerenciar SUAS guias*
- [x] **4.1** Refatorar pÃ¡gina `/billing` com tabs premium
- [x] **4.2** Tab "Nova Guia" - forms de criaÃ§Ã£o
- [x] **4.3** Tab "HistÃ³rico" - lista com filtros (operadora, status, busca)
- [x] **4.4** Tab "Lotes" - clÃ­nica agrupa guias para envio em lote (LotesTab, LoteCard, CreateLoteModal)
- [x] **4.5** Tab "Glosas" - clÃ­nica vÃª suas guias glosadas
- [x] **4.6** Tab "RelatÃ³rios" - analytics do faturamento da clÃ­nica (ReportsTab, ReportComponents)
- [x] **4.7** Componente `GuiaListItem` com status visual
- [x] **4.8** Componente `GuiaDetail` modal/drawer (guia-constants.ts extraÃ­do)

**VALIDAÃ‡ÃƒO CODE_CONSTITUTION (22-23/12/2024)** âœ…
- [x] Zero TODOs/FIXMEs/HACKs nos novos arquivos
- [x] Todos os arquivos < 500 linhas (refatoraÃ§Ã£o semÃ¢ntica completa)
- [x] Lint 100% passando (0 erros)
- [x] Typecheck 100% passando (0 erros)
- [x] **Testes com 1159 tests passando**
- [x] JSDoc/Docstrings em todos os mÃ³dulos pÃºblicos

**RefatoraÃ§Ã£o SemÃ¢ntica (23/12/2024):**
| Arquivo | Antes | Depois | Status |
|---------|-------|--------|--------|
| TissSADTForm.tsx | 587 | 459 | âœ… OK |
| TissConsultaForm.tsx | 533 | 466 | âœ… OK |
| CertificadoUpload.tsx | 522 | 336 | âœ… OK |

**Componentes ExtraÃ­dos:**
```
src/components/billing/TissFormSections.tsx (263 linhas)
  - OperadoraSection: SeÃ§Ã£o de dados da operadora
  - BeneficiarioSection: SeÃ§Ã£o de dados do beneficiÃ¡rio (com modo compacto)
  - SolicitacaoSection: SeÃ§Ã£o de dados da solicitaÃ§Ã£o

src/components/billing/certificate-utils.ts (113 linhas)
  - getCertificateStatus(): Calcula status do certificado
  - getStatusDisplay(): Retorna cores e labels
  - mockValidateCertificate(): Mock de validaÃ§Ã£o

src/components/billing/CertificateDisplay.tsx (144 linhas)
  - Componente de exibiÃ§Ã£o do certificado configurado
```

**Arquivos de Teste Criados:**
```
src/__tests__/services/firestore/operadora.service.test.ts (15 tests)
src/__tests__/services/firestore/guia.service.test.ts (14 tests)
src/__tests__/hooks/useOperadoras.test.ts (17 tests)
src/__tests__/hooks/useGuias.test.ts (21 tests)
src/__tests__/components/billing/LotesTab.test.tsx (28 tests)
src/__tests__/components/billing/ReportComponents.test.tsx (18 tests)
src/__tests__/components/billing/guia-constants.test.ts (18 tests)
```

**Todos os Arquivos Billing < 500 linhas:**
```
466 TissConsultaForm.tsx
459 TissSADTForm.tsx
418 ReportsTab.tsx
405 GuiaDetail.tsx
365 TissPreview.tsx
340 LoteCard.tsx
336 CertificadoUpload.tsx
290 ProcedimentoItem.tsx
274 CreateLoteModal.tsx
263 TissFormSections.tsx
238 ReportComponents.tsx
224 LotesTab.tsx
144 CertificateDisplay.tsx
125 guia-constants.ts
113 certificate-utils.ts
```

---

**ETAPA 5: Envio para Operadoras** âœ…
> *Backend que NÃ“S fornecemos para enviar guias DA CLÃNICA usando credenciais DA CLÃNICA*
- [x] **5.1** Cloud Function `createLote` - agrupa guias da clÃ­nica
- [x] **5.2** Cloud Function `sendLote` - envia usando WebService/credenciais da clÃ­nica
- [x] **5.3** Assinatura XML com certificado DA CLÃNICA (xml-signer.ts com XMLDSig)
- [x] **5.4** Salvar protocolo e resposta no Firestore da clÃ­nica
- [x] **5.5** Atualizar status das guias da clÃ­nica
- [x] **5.6** Retry automÃ¡tico em caso de falha (retrySendLote com backoff)

**ETAPA 6: Recebimento de Respostas** âœ…
> *Backend que NÃ“S fornecemos para processar respostas das operadoras*
- [x] **6.1** Webhook para receber retorno das operadoras (webhookReceiver)
- [x] **6.2** Parser de XML de glosa (parseDemonstrativoXml)
- [x] **6.3** Criar registros de Glosa automaticamente (receiveResponse)
- [x] **6.4** Atualizar status da guia (glosada_parcial, paga, etc)
- [x] **6.5** NotificaÃ§Ã£o in-app + trigger onGlosaCreated + checkGlosaDeadlines

**ETAPA 7: Recurso de Glosa** âœ…
- [x] **7.1** Cloud Function createRecurso (itensContestados + justificativas)
- [x] **7.2** Suporte a documentos comprobatÃ³rios (documentosAnexos field)
- [x] **7.3** GeraÃ§Ã£o de XML de recurso (TISS 4.02.00 format)
- [x] **7.4** Cloud Function sendRecurso + getRecursoStatus

**ETAPA 8: RelatÃ³rios e Analytics** âœ…
- [x] **8.1** Dashboard de faturamento (ReportsTab, StatCard, StatusChart)
- [x] **8.2** AnÃ¡lise de glosas (GlosasAnalysis component, useGlosas hook)
- [x] **8.3** Faturamento por operadora (OperatorBreakdown)
- [x] **8.4** Taxa de glosa por perÃ­odo (filtros por data + KPIs)
- [x] **8.5** ExportaÃ§Ã£o CSV/PDF (export.ts utilities)

#### 8b.3 Arquivos a Criar/Modificar

**Tipos:**
```
src/types/tiss.ts                    # Expandir com Lote, WebServiceConfig
```

**Services:**
```
src/services/firestore/operadora.service.ts    # CRUD operadoras
src/services/tiss/lote.service.ts              # GestÃ£o de lotes
src/services/tiss/envio.service.ts             # Envio para operadoras
src/services/crypto/certificate.service.ts     # Assinatura digital
```

**Hooks:**
```
src/hooks/useOperadoras.ts           # Lista operadoras da clÃ­nica
src/hooks/useGuias.ts                # CRUD guias com real-time
src/hooks/useLotes.ts                # GestÃ£o de lotes
src/hooks/useGlosas.ts               # Lista glosas
```

**Componentes:**
```
src/components/billing/
â”œâ”€â”€ OperadoraForm.tsx                # Form de operadora
â”œâ”€â”€ OperadoraList.tsx                # Lista de operadoras
â”œâ”€â”€ GuiasList.tsx                    # Lista de guias
â”œâ”€â”€ GuiaCard.tsx                     # Card de guia
â”œâ”€â”€ GuiaDetail.tsx                   # Detalhes da guia (405 linhas)
â”œâ”€â”€ guia-constants.ts                # STATUS_CONFIG, TIPO_GUIA_LABELS, formatters (125 linhas)
â”œâ”€â”€ LotesTab.tsx                     # Tab de lotes (224 linhas)
â”œâ”€â”€ LoteCard.tsx                     # Card de lote expandÃ­vel (340 linhas)
â”œâ”€â”€ CreateLoteModal.tsx              # Modal criar lote (274 linhas)
â”œâ”€â”€ GlosasList.tsx                   # Lista de glosas
â”œâ”€â”€ GlosaDetail.tsx                  # Detalhes da glosa
â”œâ”€â”€ RecursoForm.tsx                  # Form de recurso
â”œâ”€â”€ CertificadoUpload.tsx            # Upload de certificado (336 linhas)
â”œâ”€â”€ CertificateDisplay.tsx           # ExibiÃ§Ã£o certificado (144 linhas)
â”œâ”€â”€ certificate-utils.ts             # Helpers certificado (113 linhas)
â”œâ”€â”€ ReportsTab.tsx                   # Tab relatÃ³rios (418 linhas)
â”œâ”€â”€ ReportComponents.tsx             # StatCard, StatusChart, OperatorBreakdown (238 linhas)
â”œâ”€â”€ TissConsultaForm.tsx             # Form consulta TISS (466 linhas)
â”œâ”€â”€ TissSADTForm.tsx                 # Form SP/SADT TISS (459 linhas)
â”œâ”€â”€ TissFormSections.tsx             # SeÃ§Ãµes reutilizÃ¡veis (263 linhas)
â”œâ”€â”€ ProcedimentoItem.tsx             # Item de procedimento (290 linhas)
â”œâ”€â”€ TissPreview.tsx                  # Preview XML (365 linhas)
â””â”€â”€ FaturamentoChart.tsx             # GrÃ¡fico de faturamento
```

**PÃ¡ginas:**
```
src/pages/Billing.tsx                # Refatorar com tabs
src/pages/settings/ConveniosTab.tsx  # Tab em Settings
```

**Cloud Functions:** âœ… IMPLEMENTADO (23/12/2024)
```
functions/src/tiss/
â”œâ”€â”€ index.ts                         # Exports pÃºblicos das Cloud Functions
â”œâ”€â”€ types.ts                         # Tipos TypeScript (EncryptedData, CertificateInfo, etc.)
â”œâ”€â”€ encryption.ts                    # AES-256-GCM criptografia de certificados
â”œâ”€â”€ certificate.ts                   # GestÃ£o de certificados (upload, validaÃ§Ã£o, storage)
â”œâ”€â”€ xml-signer.ts                    # XMLDSig assinatura digital
â”œâ”€â”€ lote.ts                          # CRUD de lotes (createLote, deleteLote, updateStatus)
â”œâ”€â”€ sender.ts                        # Envio WebService (sendLote, retrySendLote)
â”œâ”€â”€ response-handler.ts              # Recebimento de respostas (receiveResponse, webhookReceiver)
â”œâ”€â”€ glosa-triggers.ts                # Triggers de glosa (onGlosaCreated, checkGlosaDeadlines)
â”œâ”€â”€ recurso.ts                       # Recurso de glosa (createRecurso, sendRecurso)
â””â”€â”€ __tests__/                       # Testes Vitest (138 tests, 92%+ coverage)
    â”œâ”€â”€ encryption.test.ts           # 30 tests - encrypt/decrypt, certificados
    â”œâ”€â”€ certificate.test.ts          # 23 tests - validaÃ§Ã£o, CNPJ, storage
    â”œâ”€â”€ xml-signer.test.ts           # 18 tests - XMLDSig, hash, assinatura
    â”œâ”€â”€ lote.test.ts                 # 24 tests - CRUD lotes, transaÃ§Ãµes
    â”œâ”€â”€ sender.test.ts               # 19 tests - WebService, retry, auth types
    â”œâ”€â”€ response-handler.test.ts     # 11 tests - parse demonstrativo, glosas
    â””â”€â”€ recurso.test.ts              # 13 tests - criar/enviar recursos
```

**Firestore Rules:**
```
firestore.rules                      # Adicionar operadoras, lotes
```

#### 8b.4 Ordem de ImplementaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ORDEM DE IMPLEMENTAÃ‡ÃƒO                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  DIA 1: Infraestrutura                                      â”‚
â”‚  â”œâ”€ 1.1-1.6: Types, collections, services base              â”‚
â”‚  â””â”€ 2.1-2.2: Tab ConvÃªnios em Settings                      â”‚
â”‚                                                             â”‚
â”‚  DIA 2: ConfiguraÃ§Ã£o                                        â”‚
â”‚  â”œâ”€ 2.3-2.6: Certificado + Operadoras CRUD                  â”‚
â”‚  â””â”€ 3.1-3.3: Hook useGuias + Forms                          â”‚
â”‚                                                             â”‚
â”‚  DIA 3: GestÃ£o de Guias                                     â”‚
â”‚  â”œâ”€ 3.4-3.7: Completar forms                                â”‚
â”‚  â””â”€ 4.1-4.8: PÃ¡gina Billing com tabs                        â”‚
â”‚                                                             â”‚
â”‚  DIA 4: Envio e Recebimento                                 â”‚
â”‚  â”œâ”€ 5.1-5.6: Cloud Functions de envio                       â”‚
â”‚  â””â”€ 6.1-6.5: Webhook de resposta                            â”‚
â”‚                                                             â”‚
â”‚  DIA 5: Glosas e RelatÃ³rios                                 â”‚
â”‚  â”œâ”€ 7.1-7.4: Recurso de glosa                               â”‚
â”‚  â””â”€ 8.1-8.5: Dashboard e relatÃ³rios                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 8b.5 DependÃªncias Externas (ClÃ­nica precisa ter)

| Item | Responsabilidade | ObservaÃ§Ã£o |
|------|------------------|------------|
| CNES | ClÃ­nica | Cadastro no DATASUS |
| CNPJ | ClÃ­nica | JÃ¡ deve ter |
| Certificado Digital | ClÃ­nica | e-CNPJ A1 recomendado |
| Credenciamento | ClÃ­nica | Contrato com cada operadora |
| CÃ³digo de Prestador | ClÃ­nica | Fornecido pela operadora |

#### 8b.6 Testes e ValidaÃ§Ã£o âœ… COMPLETO (23/12/2024)

**Cloud Functions TISS - 114 tests, 92%+ coverage:**
- [x] Testes unitÃ¡rios para criptografia (AES-256-GCM)
- [x] Testes de validaÃ§Ã£o de certificados (PFX/P12)
- [x] Testes de assinatura digital (XMLDSig)
- [x] Testes de gestÃ£o de lotes (CRUD + transaÃ§Ãµes)
- [x] Mock de WebService para testes (HTTPS mocking)
- [ ] Teste com operadora em ambiente de homologaÃ§Ã£o (pendente)

**Cobertura de CÃ³digo (Core Modules):**
```
 % Coverage report from v8
-----------------|---------|----------|---------|---------|
File             | % Stmts | % Branch | % Funcs | % Lines |
-----------------|---------|----------|---------|---------|
All files        |   92.17 |    81.98 |     100 |   92.17 |
 certificate.ts  |   91.98 |    74.13 |     100 |   91.98 |
 encryption.ts   |   91.04 |    81.81 |     100 |   91.04 |
 lote.ts         |   89.49 |       90 |     100 |   89.49 |
 sender.ts       |   93.19 |    81.15 |     100 |   93.19 |
 xml-signer.ts   |   94.85 |    85.29 |     100 |   94.85 |
-----------------|---------|----------|---------|---------|
```

**MÃ³dulos Adicionais (requerem testes de integraÃ§Ã£o):**
- `response-handler.ts` - 11 testes unitÃ¡rios
- `glosa-triggers.ts` - Triggers Firebase (scheduler/onCreate)
- `recurso.ts` - 13 testes unitÃ¡rios

**ConfiguraÃ§Ã£o de Testes:**
- Framework: Vitest com ambiente Node.js
- Coverage: v8 provider
- Thresholds: 90% lines/statements, 80% branches, 100% functions

**Arquivos de ConfiguraÃ§Ã£o:**
```
functions/
â”œâ”€â”€ package.json                     # Scripts: test, test:watch, test:coverage
â””â”€â”€ vitest.config.ts                 # ConfiguraÃ§Ã£o Vitest + coverage thresholds
```

**Scripts disponÃ­veis:**
```bash
cd functions
npm test              # Roda todos os testes
npm run test:watch    # Watch mode para desenvolvimento
npm run test:coverage # Gera relatÃ³rio de cobertura
```

#### 8b.7 DocumentaÃ§Ã£o para ClÃ­nicas (Onboarding) âœ…

> **CRÃTICO:** DocumentaÃ§Ã£o completa para clÃ­nicas configurarem convÃªnios.

**Arquivo criado:** `docs/guias/CONFIGURACAO_CONVENIOS.md`

**ConteÃºdo do Guia:**

```markdown
# Guia: Configurar Faturamento de ConvÃªnios

## PrÃ©-requisitos (o que sua clÃ­nica precisa ter)

### 1. CNES - Cadastro Nacional de Estabelecimentos de SaÃºde
- O que Ã©: Registro obrigatÃ³rio de todo estabelecimento de saÃºde
- Como obter: https://cnes.datasus.gov.br/
- Prazo: 5-15 dias Ãºteis
- Documentos: CNPJ, AlvarÃ¡, ResponsÃ¡vel TÃ©cnico

### 2. Certificado Digital e-CNPJ
- O que Ã©: Identidade digital da sua clÃ­nica
- Tipo recomendado: A1 (arquivo .pfx)
- Onde comprar: Serasa, Certisign, Valid, Safeweb
- Custo mÃ©dio: R$ 150-300/ano
- Prazo: 1-3 dias Ãºteis

### 3. Credenciamento com Operadoras
- Cada operadora tem processo prÃ³prio
- Documentos comuns: CNES, CNPJ, CRM dos profissionais
- Prazo: 15-60 dias por operadora

## Passo a Passo no Genesis OS

### Passo 1: Dados Cadastrais
1. Acesse ConfiguraÃ§Ãµes â†’ ConvÃªnios
2. Preencha CNES e CNPJ da clÃ­nica
3. Salve

### Passo 2: Certificado Digital
1. Clique em "Enviar Certificado"
2. Selecione arquivo .pfx ou .p12
3. Digite a senha do certificado
4. Sistema valida e armazena (criptografado)

### Passo 3: Cadastrar Operadora
1. Clique em "Nova Operadora"
2. Preencha:
   - Nome (ex: UNIMED Campinas)
   - Registro ANS (6 dÃ­gitos)
   - CÃ³digo do Prestador (fornecido pela operadora)
   - Tabela de preÃ§os (TUSS, CBHPM, ou prÃ³pria)
3. Configure WebService (se disponÃ­vel):
   - URL do WebService
   - UsuÃ¡rio/Senha ou Token
4. Teste conexÃ£o
5. Salve

### Passo 4: Criar Primeira Guia
1. Acesse Faturamento â†’ Nova Guia
2. Selecione tipo (Consulta ou SP/SADT)
3. Selecione operadora
4. Preencha dados do atendimento
5. Sistema valida automaticamente
6. Salve como rascunho ou envie

## Operadoras Mais Comuns

### UNIMED
- Registro ANS: varia por regional
- WebService: WSD-TISS (cada regional tem URL)
- Contato: Dept. Credenciamento da UNIMED local

### Bradesco SaÃºde
- Portal: wwws.bradescosaude.com.br
- Primeiro acesso: cadastro de usuÃ¡rio Master
- WebService: disponÃ­vel apÃ³s credenciamento

### SulAmÃ©rica
- Portal: saude.sulamericaseguros.com.br/prestador
- WebService: solicitar via tiss@sulamerica.com.br
- RGE: Recurso de Glosa EletrÃ´nico disponÃ­vel

### Amil
- Portal: credenciado.amil.com.br
- Manual: disponÃ­vel no portal
- VersÃ£o TISS: 4.01 obrigatÃ³ria

### GEAP (Servidores Federais)
- Sistema: TMS (True Auditoria)
- Portal: www2.geap.com.br/auth/prestadorVue.asp
- Credenciamento: wwwapp.geap.com.br/prestador/sejaprestador

### CASSI (Banco do Brasil)
- Portal: www.cassi.com.br/credenciado-cassi
- Sistema: AFR (autorizaÃ§Ã£o em tempo real)
- Central: 0800 729 0080

## Problemas Comuns

### "Certificado invÃ¡lido"
- Verifique se Ã© tipo A1 (.pfx ou .p12)
- Confirme que nÃ£o estÃ¡ expirado
- Senha correta?

### "CÃ³digo do prestador nÃ£o encontrado"
- Confirme com a operadora seu cÃ³digo
- Verifique se credenciamento estÃ¡ ativo

### "Guia rejeitada"
- Verifique campos obrigatÃ³rios
- Confira cÃ³digo TUSS do procedimento
- Senha de autorizaÃ§Ã£o expirada?

### "Glosa recebida"
- Acesse Faturamento â†’ Glosas
- Veja motivo especÃ­fico
- Prepare recurso se aplicÃ¡vel

## Suporte

- Email: suporte@clinicagenesis.com.br
- WhatsApp: (XX) XXXXX-XXXX
- Central de Ajuda: /help no sistema
```

**Checklist de DocumentaÃ§Ã£o:**
- [ ] **8b.7.1** Criar `docs/user-guides/CONFIGURAR_CONVENIOS.md`
- [ ] **8b.7.2** Criar seÃ§Ã£o "ConvÃªnios" no Help Center (`/help`)
- [ ] **8b.7.3** Adicionar tooltips/hints nos forms de configuraÃ§Ã£o
- [ ] **8b.7.4** Criar vÃ­deo tutorial (opcional, futuro)
- [ ] **8b.7.5** FAQ de problemas comuns
- [ ] **8b.7.6** Links para portais de cada operadora

---

### FASE 9: WORKFLOW AUTOMATION (Sprint 10) âœ… COMPLETO
**Objetivo:** AutomaÃ§Ã£o de processos e integraÃ§Ãµes externas via Cloud Functions nativas
**Status:** âœ… COMPLETO (23/12/2024)

> **DecisÃ£o Arquitetural:** ApÃ³s auditoria do sistema, optou-se por implementar os workflows
> como Cloud Functions nativas em vez de n8n externo. Motivos:
> - Sistema jÃ¡ tinha WhatsApp e Glosa triggers implementados
> - Menos dependÃªncia externa
> - Melhor controle e debugging
> - Custo zero adicional (jÃ¡ no Firebase)

#### 9.1 Arquitetura Implementada
**Cloud Functions nativas para automaÃ§Ã£o**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     WORKFLOWS CLOUD FUNCTIONS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚    SCHEDULERS    â”‚    â”‚     TRIGGERS     â”‚                   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                   â”‚
â”‚  â”‚  â€¢ Follow-up 2h  â”‚    â”‚  â€¢ onAppointment â”‚                   â”‚
â”‚  â”‚  â€¢ NPS Survey 1h â”‚    â”‚  â€¢ onGlosa       â”‚                   â”‚
â”‚  â”‚  â€¢ Return 10:00  â”‚    â”‚  â€¢ Webhooks      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚             â”‚                    â”‚                               â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                      â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     WhatsApp API                           â”‚  â”‚
â”‚  â”‚  â€¢ Templates aprovados (confirmation, reminder_24h, etc)   â”‚  â”‚
â”‚  â”‚  â€¢ Free-form messages (within 24h window)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 9.2 Workflows Implementados âœ…

**1. Follow-up PÃ³s-Consulta** âœ…
- Cloud Function: `sendFollowUpMessages`
- Schedule: A cada 2 horas
- Envia mensagem de acompanhamento 24h apÃ³s consulta finalizada
- ConfigurÃ¡vel por clÃ­nica (delay em horas)

**2. Pesquisa NPS** âœ…
- Cloud Functions: `sendNPSSurveys`, `npsResponseWebhook`
- Schedule: A cada 1 hora
- Envia pesquisa de satisfaÃ§Ã£o (0-10) 2h apÃ³s consulta
- Calcula NPS score automaticamente
- Alerta em detractors (score < 7)

**3. Lembrete de Retorno** âœ…
- Cloud Function: `sendPatientReturnReminders`
- Schedule: DiÃ¡rio Ã s 10:00
- Identifica pacientes inativos (90+ dias por padrÃ£o)
- Limite: 50 lembretes/dia/clÃ­nica (anti-spam)
- FrequÃªncia configurÃ¡vel por clÃ­nica

**4. IntegraÃ§Ã£o com Labs** âœ…
- Cloud Function: `labsResultWebhook`
- Webhook para receber resultados de laboratÃ³rios externos
- Valida HMAC signature
- Notifica paciente quando resultado disponÃ­vel
- Alerta mÃ©dico se valores crÃ­ticos
- Suporta HL7/JSON payloads

#### 9.3 Arquivos Criados

**Cloud Functions:**
```
functions/src/workflows/
â”œâ”€â”€ index.ts              # Exports
â”œâ”€â”€ types.ts              # Tipos e interfaces
â”œâ”€â”€ follow-up.ts          # Follow-up pÃ³s-consulta
â”œâ”€â”€ nps.ts                # Pesquisa NPS
â”œâ”€â”€ patient-return.ts     # Lembrete de retorno
â””â”€â”€ labs-webhook.ts       # IntegraÃ§Ã£o laboratÃ³rios
```

**Frontend:**
```
src/components/settings/
â””â”€â”€ WorkflowSettings.tsx  # UI de configuraÃ§Ã£o de workflows
```

**Settings Page:**
- Nova tab "AutomaÃ§Ãµes" em Settings
- Toggle on/off por workflow
- ConfiguraÃ§Ãµes personalizÃ¡veis (delays, frequÃªncias)
- Webhook URL para integraÃ§Ã£o com labs

#### 9.4 ConfiguraÃ§Ã£o por ClÃ­nica

Cada clÃ­nica pode habilitar/configurar independentemente:

| Workflow | ParÃ¢metros ConfigurÃ¡veis |
|----------|--------------------------|
| Follow-up | `delayHours` (default: 24) |
| NPS | `delayHours` (default: 2) |
| Patient Return | `inactiveDays` (90), `reminderFrequencyDays` (30) |
| Labs Integration | `notifyPatient`, `notifyDoctor`, `webhookSecret` |

```typescript
// Firestore: clinics/{clinicId}/settings/workflows
{
  followUp: { enabled: true, delayHours: 24 },
  nps: { enabled: true, delayHours: 2 },
  patientReturn: { enabled: false, inactiveDays: 90 },
  labsIntegration: { enabled: false, notifyPatient: true }
}
```

#### 9.5 Workflows Existentes (PrÃ©-FASE 9)

JÃ¡ implementados em fases anteriores:
- [x] ConfirmaÃ§Ã£o de agendamento (WhatsApp) - `onAppointmentCreated`
- [x] Lembrete 24h antes (WhatsApp) - `sendReminders24h`
- [x] Lembrete 2h antes (WhatsApp) - `sendReminders2h`
- [x] NotificaÃ§Ã£o de glosa - `onGlosaCreated`
- [x] Alerta prazo recurso - `checkGlosaDeadlines`
- [x] Webhooks Stripe (pagamentos) - `stripeWebhook`

#### 9.6 MÃ©tricas e Logs

Todos os workflows geram logs em:
```
clinics/{clinicId}/workflowLogs/
â”œâ”€â”€ workflowType: 'follow_up' | 'nps' | 'patient_return' | 'lab_result'
â”œâ”€â”€ targetId: appointmentId | patientId | labResultId
â”œâ”€â”€ status: 'pending' | 'sent' | 'delivered' | 'failed'
â”œâ”€â”€ channel: 'whatsapp' | 'email' | 'in_app'
â”œâ”€â”€ messageId?: string
â”œâ”€â”€ error?: string
â””â”€â”€ createdAt: timestamp
```

---

### FASE 10: UI/UX PREMIUM POLISH (Sprint 11-12) âœ… COMPLETO
**Objetivo:** Elevar Genesis OS ao padrÃ£o de REFERÃŠNCIA em software para clÃ­nicas mÃ©dicas
**Status:** âœ… IMPLEMENTAÃ‡ÃƒO COMPLETA (23/12/2024) - Sprint 1-6 Completos (40/40 itens - 100%)
**Completados:** Patient Portal (10), Telemedicina (4), STATUS_CONFIG (5), Focus Rings (11), Micro-interaÃ§Ãµes (3), ARIA (4), Grids (2)

> **VISÃƒO:** Ser a REFERÃŠNCIA ABSOLUTA em software para clÃ­nicas mÃ©dicas.
> Mostrar TUDO que implementamos de forma fluida, intuitiva, bonita, leve e otimizada.

---

#### 10.1 Stack TÃ©cnica Atual (Dezembro 2025)

| Tecnologia | VersÃ£o | DocumentaÃ§Ã£o |
|------------|--------|--------------|
| **Tailwind CSS** | v4.1.18 | [tailwindcss.com/docs](https://tailwindcss.com/docs/theme) |
| **React** | v19.2.3 | [react.dev](https://react.dev) |
| **Vite** | v6.2.0 | [vite.dev](https://vite.dev) |
| **TypeScript** | v5.8.2 | [typescriptlang.org](https://www.typescriptlang.org) |
| **PostCSS** | v8.5.6 | Via @tailwindcss/postcss |

---

#### 10.2 Arquitetura Tailwind CSS v4 do Projeto

> **IMPORTANTE:** Tailwind v4 usa configuraÃ§Ã£o CSS-first. NÃƒO existe `tailwind.config.js`.
> Toda configuraÃ§Ã£o estÃ¡ em `index.css` usando a diretiva `@theme`.

**ReferÃªncias oficiais consultadas:**
- [Tailwind CSS v4 Theme Variables](https://tailwindcss.com/docs/theme)
- [Tailwind CSS v4 Dark Mode](https://tailwindcss.com/docs/dark-mode)
- [Tailwind CSS v4 Functions and Directives](https://tailwindcss.com/docs/functions-and-directives)

##### Estrutura do `index.css`:

```css
/* 1. Import do Tailwind (substitui @tailwind base/components/utilities) */
@import "tailwindcss";

/* 2. Diretiva @theme - Define tokens que geram utility classes */
@theme {
  /* Cores: --color-* gera bg-*, text-*, border-* automaticamente */
  --color-genesis-primary: #0f766e;
  --color-genesis-surface: #ffffff;
  --color-genesis-soft: #f8fafc;
  /* ... */
}

/* 3. Dark mode - Override das variÃ¡veis com seletor .dark */
.dark {
  --color-genesis-primary: #14b8a6;
  --color-genesis-surface: #0f172a;
  --color-genesis-soft: #1e293b;
  /* ... */
}
```

##### Como funciona o @theme no Tailwind v4:

| Namespace CSS Variable | Classes Geradas | Exemplo |
|------------------------|-----------------|---------|
| `--color-*` | `bg-*`, `text-*`, `border-*` | `--color-genesis-primary` â†’ `bg-genesis-primary` |
| `--font-*` | `font-*` | `--font-sans` â†’ `font-sans` |
| `--spacing-*` | `p-*`, `m-*`, `gap-*` | `--spacing-4` â†’ `p-4` |
| `--radius-*` | `rounded-*` | `--radius-lg` â†’ `rounded-lg` |

##### Dark Mode no Tailwind v4:

```css
/* OpÃ§Ã£o 1: Media query (padrÃ£o) - Respeita prefers-color-scheme */
/* NÃ£o precisa configuraÃ§Ã£o adicional */

/* OpÃ§Ã£o 2: Classe .dark (nosso caso) - Override manual */
/* Definido em index.css com seletor .dark { } */
```

**CRÃTICO:** Em Tailwind v4, as variÃ¡veis CSS definidas em `@theme` sÃ£o automaticamente
atualizadas quando `.dark` Ã© aplicado no `<html>`. Por isso, usar `bg-genesis-surface`
funciona corretamente em AMBOS os modos (light/dark).

---

#### 10.3 Mapeamento de Tokens - Guia de CorreÃ§Ã£o

> **REGRA:** NUNCA usar cores hardcoded. SEMPRE usar tokens genesis-*.

##### Cores de SuperfÃ­cie:

| âŒ ERRADO | âœ… CORRETO | RazÃ£o |
|-----------|------------|-------|
| `bg-white` | `bg-genesis-surface` | Adapta: #ffffff (light) â†’ #0f172a (dark) |
| `bg-gray-50` | `bg-genesis-soft` | Adapta: #f8fafc (light) â†’ #1e293b (dark) |
| `bg-gray-100` | `bg-genesis-hover` | Adapta: #f1f5f9 (light) â†’ #334155 (dark) |

##### Cores de Texto:

| âŒ ERRADO | âœ… CORRETO | RazÃ£o |
|-----------|------------|-------|
| `text-gray-900` | `text-genesis-dark` | Adapta: #0f172a (light) â†’ #f1f5f9 (dark) |
| `text-gray-700` | `text-genesis-text` | Adapta: #1e293b (light) â†’ #e2e8f0 (dark) |
| `text-gray-500` | `text-genesis-muted` | Adapta: #64748b (light) â†’ #94a3b8 (dark) |
| `text-gray-400` | `text-genesis-subtle` | Adapta: #94a3b8 (light) â†’ #64748b (dark) |

##### Cores de Borda:

| âŒ ERRADO | âœ… CORRETO | RazÃ£o |
|-----------|------------|-------|
| `border-gray-100` | `border-genesis-border-subtle` | Adapta para dark |
| `border-gray-200` | `border-genesis-border` | Adapta para dark |
| `border-white` | `border-genesis-surface` | Adapta para dark |

##### Cores SemÃ¢nticas (Status):

| âŒ ERRADO | âœ… CORRETO | Uso |
|-----------|------------|-----|
| `bg-green-100 text-green-600` | `bg-success-soft text-success` | Sucesso, pago, aprovado |
| `bg-red-100 text-red-600` | `bg-danger-soft text-danger` | Erro, glosado, cancelado |
| `bg-amber-100 text-amber-600` | `bg-warning-soft text-warning` | Alerta, pendente |
| `bg-blue-100 text-blue-600` | `bg-info-soft text-info` | Info, enviado, em anÃ¡lise |

##### Focus Ring:

| âŒ ERRADO | âœ… CORRETO |
|-----------|------------|
| `focus:ring-blue-500` | `focus:ring-genesis-primary` |
| `focus:ring-purple-500` | `focus:ring-genesis-primary` |

---

#### 10.4 Resultados da Auditoria UI/UX (23/12/2024)

##### Resumo Executivo:

| Ãrea | Score Atual | Score Meta | Gap |
|------|-------------|------------|-----|
| Design System Core | 95/100 | 98/100 | 3% |
| **Dark Mode** | **65/100** | **98/100** | **33%** |
| Micro-interaÃ§Ãµes | 78/100 | 95/100 | 17% |
| Acessibilidade | 75/100 | 95/100 | 20% |
| **Cores Hardcoded** | **70/100** | **100/100** | **30%** |
| Loading/Empty States | 85/100 | 95/100 | 10% |
| **GERAL** | **78/100** | **97/100** | **19%** |

##### ViolaÃ§Ãµes Encontradas:

| Tipo de ViolaÃ§Ã£o | Quantidade | Severidade |
|------------------|------------|------------|
| `bg-white` sem dark mode | 37 instÃ¢ncias | ğŸ”´ CRÃTICA |
| Cores gray-* hardcoded | 30+ instÃ¢ncias | ğŸ”´ CRÃTICA |
| Focus ring incorreto | 50+ instÃ¢ncias | ğŸŸ¡ ALTA |
| Micro-interaÃ§Ãµes faltando | 50+ instÃ¢ncias | ğŸŸ¡ ALTA |
| ARIA attributes faltando | 20+ instÃ¢ncias | ğŸŸ¢ MÃ‰DIA |

---

#### 10.5 Arquivos CrÃ­ticos para CorreÃ§Ã£o

##### TIER 1: Patient Portal (CRÃTICO - Face pÃºblica)

| # | Arquivo | ViolaÃ§Ãµes | Problema |
|---|---------|-----------|----------|
| 1 | `src/pages/patient-portal/Login.tsx` | 2x `bg-white` | **AUTH QUEBRADA NO DARK** |
| 2 | `src/pages/patient-portal/Dashboard.tsx` | 6x `bg-white` | Dashboard ilegÃ­vel |
| 3 | `src/components/patient-portal/PatientPortalLayout.tsx` | 4x `bg-white` | Layout base quebrado |
| 4 | `src/pages/patient-portal/Messages.tsx` | 4x `bg-white` | Chat ilegÃ­vel |
| 5 | `src/pages/patient-portal/LabResults.tsx` | 4x `bg-white` | Resultados quebrados |
| 6 | `src/pages/patient-portal/Appointments.tsx` | 3x `bg-white` | Agenda quebrada |
| 7 | `src/pages/patient-portal/Prescriptions.tsx` | 3x `bg-white` | Receitas quebradas |

##### TIER 2: Telemedicina (CRÃTICO - Video calls)

| # | Arquivo | ViolaÃ§Ãµes | Problema |
|---|---------|-----------|----------|
| 8 | `src/components/telemedicine/WaitingRoom.tsx` | 6x gray hardcoded | Sala de espera nÃ£o adapta |
| 9 | `src/components/telemedicine/VideoRoom.tsx` | 3x gray hardcoded | Video room quebrado |
| 10 | `src/components/telemedicine/TelemedicineModal.tsx` | 2x gray | Modal quebrado |

##### TIER 3: Billing/TISS (ALTO - Revenue critical)

| # | Arquivo | ViolaÃ§Ãµes | Problema |
|---|---------|-----------|----------|
| 11 | `src/pages/Billing.tsx` | STATUS_CONFIG hardcoded | Status colors nÃ£o adaptam |
| 12 | `src/components/billing/LoteCard.tsx` | STATUS_CONFIG hardcoded | Lotes nÃ£o adaptam |
| 13 | `src/components/billing/TissConsultaForm.tsx` | 5x focus:ring-blue | Focus incorreto |
| 14 | `src/components/billing/TissSADTForm.tsx` | 2x focus:ring-purple | Focus incorreto |
| 15 | `src/components/billing/ProcedimentoItem.tsx` | 9x focus:ring-purple | Focus incorreto |
| 16 | `src/components/billing/TissFormSections.tsx` | 8x focus:ring-purple | Focus incorreto |

##### TIER 4: Settings/Analytics (MÃ‰DIO)

| # | Arquivo | ViolaÃ§Ãµes | Problema |
|---|---------|-----------|----------|
| 17 | `src/components/settings/WorkflowSettings.tsx` | 2x gray + 1x bg-white | Toggle quebrado |
| 18 | `src/components/settings/ConvenioSettings.tsx` | 2x gray | Badges quebrados |
| 19 | `src/components/analytics/PatientInsights.tsx` | 3x gray | NPS cards quebrados |

---

#### 10.6 Checklist de ImplementaÃ§Ã£o

##### SPRINT 1: Dark Mode Critical (2-3 dias)

**Prioridade 1 - Patient Portal:**
- [x] **10.6.1** Corrigir `Login.tsx` - Substituir `bg-white` por `bg-genesis-surface` âœ…
- [x] **10.6.2** Corrigir `Dashboard.tsx` - 6 substituiÃ§Ãµes âœ…
- [x] **10.6.3** Corrigir `PatientPortalLayout.tsx` - 4 substituiÃ§Ãµes âœ…
- [x] **10.6.4** Corrigir `Messages.tsx` - 4 substituiÃ§Ãµes âœ…
- [x] **10.6.5** Corrigir `LabResults.tsx` - 4 substituiÃ§Ãµes âœ…
- [x] **10.6.6** Corrigir `Appointments.tsx` - 3 substituiÃ§Ãµes âœ…
- [x] **10.6.7** Corrigir `Prescriptions.tsx` - 3 substituiÃ§Ãµes âœ…
- [x] **10.6.8** Corrigir `History.tsx` - 2 substituiÃ§Ãµes âœ…
- [x] **10.6.9** Corrigir `Telehealth.tsx` - 2 substituiÃ§Ãµes âœ…
- [x] **10.6.10** Corrigir `Billing.tsx` (portal) - 1 substituiÃ§Ã£o âœ…

**Prioridade 2 - Telemedicina:**
- [x] **10.6.11** Corrigir `WaitingRoom.tsx` - 6 substituiÃ§Ãµes gray â†’ genesis âœ…
- [x] **10.6.12** Corrigir `VideoRoom.tsx` - 3 substituiÃ§Ãµes âœ…
- [x] **10.6.13** Corrigir `TelemedicineModal.tsx` - 2 substituiÃ§Ãµes âœ…
- [x] **10.6.13b** Corrigir `TelemedicineButton.tsx` - tokens + micro-interaÃ§Ãµes âœ…

##### SPRINT 2: Tokens SemÃ¢nticos (1-2 dias)

**Criar tokens de status em `index.css`:**
- [ ] **10.6.14** Adicionar tokens status-* em @theme
  ```css
  @theme {
    /* Status tokens - mapeiam para cores semÃ¢nticas */
    --color-status-draft: var(--color-genesis-muted);
    --color-status-draft-bg: var(--color-genesis-soft);
    --color-status-sent: var(--color-info);
    --color-status-sent-bg: var(--color-info-soft);
    --color-status-approved: var(--color-success);
    --color-status-approved-bg: var(--color-success-soft);
    --color-status-denied: var(--color-danger);
    --color-status-denied-bg: var(--color-danger-soft);
    --color-status-pending: var(--color-warning);
    --color-status-pending-bg: var(--color-warning-soft);
  }
  ```

**Atualizar STATUS_CONFIG:**
- [x] **10.6.15** Refatorar `Billing.tsx` STATUS_CONFIG âœ…
- [x] **10.6.16** Refatorar `LoteCard.tsx` STATUS_CONFIG âœ…
- [x] **10.6.17** Refatorar `ReportComponents.tsx` STATUS_COLORS âœ…
- [x] **10.6.18** Refatorar `guia-constants.ts` âœ…
- [x] **10.6.18b** Refatorar `certificate-utils.ts` getStatusDisplay âœ…

##### SPRINT 3: Focus Rings (1 dia) âœ… COMPLETO

**Buscar e substituir em TODOS os arquivos:**
- [x] **10.6.19** `focus:ring-blue-500` â†’ `focus:ring-genesis-primary` âœ… (44 instÃ¢ncias)
- [x] **10.6.20** `focus:ring-purple-500` â†’ `focus:ring-genesis-primary` âœ…
- [x] **10.6.21** `focus:ring-blue-600` â†’ `focus:ring-genesis-primary` âœ…

**Arquivos principais:**
- [x] **10.6.22** TissConsultaForm.tsx (7 instÃ¢ncias) âœ…
- [x] **10.6.23** TissSADTForm.tsx (2 instÃ¢ncias) âœ…
- [x] **10.6.24** ProcedimentoItem.tsx (9 instÃ¢ncias) âœ…
- [x] **10.6.25** TissFormSections.tsx (8 instÃ¢ncias) âœ…
- [x] **10.6.25b** SOAPReview.tsx, AccuracyFeedback.tsx, Application.tsx âœ…
- [x] **10.6.25c** MedicationSearch.tsx, MedicationForm.tsx, PrescriptionModal.tsx, CertificateSetup.tsx âœ…

##### SPRINT 4: Micro-interaÃ§Ãµes (1-2 dias) âœ… COMPLETO

**PadrÃ£o obrigatÃ³rio para TODOS os botÃµes CTA:**
```tsx
className="... hover:scale-[1.02] hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200"
```

- [x] **10.6.26** Adicionar micro-interaÃ§Ãµes em `BookAppointment.tsx` âœ…
- [x] **10.6.27** Adicionar micro-interaÃ§Ãµes em `TissConsultaForm.tsx` âœ…
- [x] **10.6.28** Adicionar micro-interaÃ§Ãµes em Patient Portal CTAs âœ…
- [ ] **10.6.29** Verificar consistÃªncia em todos os botÃµes primÃ¡rios

##### SPRINT 5: Acessibilidade (1-2 dias)

**Tabs com ARIA:**
- [ ] **10.6.30** Adicionar `role="tablist"` em `SOAPReview.tsx`
- [ ] **10.6.31** Adicionar `role="tablist"` em `ClinicalReasoningPanel.tsx`
- [ ] **10.6.32** Adicionar `aria-selected` em tabs

**Cards clicÃ¡veis:**
- [ ] **10.6.33** Adicionar `aria-label` em `ProfessionalSelector.tsx`
- [ ] **10.6.34** Adicionar `role="region"` em `LabUploadPanel.tsx` drag area

##### SPRINT 6: Responsividade (1 dia)

**Corrigir grids fixos:**
- [ ] **10.6.35** `GuiaDetail.tsx:120` - `grid-cols-4` â†’ `grid-cols-1 md:grid-cols-2 lg:grid-cols-4`
- [ ] **10.6.36** `LoteCard.tsx:262` - mesmo padrÃ£o

---

#### 10.7 PadrÃµes de CÃ³digo ObrigatÃ³rios

##### 10.7.1 Cores - SEMPRE usar tokens:
```tsx
// âŒ PROIBIDO
<div className="bg-white border-gray-200 text-gray-900">

// âœ… OBRIGATÃ“RIO
<div className="bg-genesis-surface border-genesis-border text-genesis-dark">
```

##### 10.7.2 BotÃµes - SEMPRE com micro-interaÃ§Ãµes:
```tsx
// âŒ PROIBIDO
<button className="bg-genesis-primary text-white px-4 py-2 rounded-lg">

// âœ… OBRIGATÃ“RIO
<button className="bg-genesis-primary text-white px-4 py-2 rounded-lg
  hover:bg-genesis-primary-dark hover:scale-[1.02] hover:-translate-y-0.5
  active:scale-[0.98] transition-all duration-200">
```

##### 10.7.3 Focus - SEMPRE genesis-primary:
```tsx
// âŒ PROIBIDO
<input className="focus:ring-blue-500 focus:border-blue-500">

// âœ… OBRIGATÃ“RIO
<input className="focus:ring-genesis-primary focus:border-genesis-primary">
```

##### 10.7.4 Status badges - SEMPRE semÃ¢ntico:
```tsx
// âŒ PROIBIDO
const STATUS = {
  success: 'bg-green-100 text-green-600',
  error: 'bg-red-100 text-red-600',
};

// âœ… OBRIGATÃ“RIO
const STATUS = {
  success: 'bg-success-soft text-success',
  error: 'bg-danger-soft text-danger',
};
```

---

#### 10.8 ValidaÃ§Ã£o e Testes

##### Checklist de ValidaÃ§Ã£o:
- [ ] **10.8.1** Dark mode testado em TODAS as pÃ¡ginas patient portal
- [ ] **10.8.2** Dark mode testado em TODAS as pÃ¡ginas admin
- [ ] **10.8.3** Dark mode testado em telemedicina
- [ ] **10.8.4** Mobile responsivo testado (iPhone SE, iPad, Desktop)
- [ ] **10.8.5** Keyboard navigation funcional em todos os forms
- [ ] **10.8.6** Screen reader testado (VoiceOver/NVDA)

##### Testes Automatizados:
- [ ] **10.8.7** Criar teste de acessibilidade com axe-core
- [ ] **10.8.8** Verificar contraste de cores (WCAG 2.1 AA)
- [ ] **10.8.9** Rodar lint e typecheck

---

#### 10.9 MÃ©tricas de Sucesso

| MÃ©trica | Atual | Meta | Status |
|---------|-------|------|--------|
| ViolaÃ§Ãµes dark mode | 67 | 0 | â³ |
| Cores hardcoded | 30+ | 0 | â³ |
| Focus rings incorretos | 50+ | 0 | â³ |
| Micro-interaÃ§Ãµes faltando | 50+ | 0 | â³ |
| ARIA attributes faltando | 20+ | 0 | â³ |
| Score UX/UI geral | 78/100 | 97/100 | â³ |

---

#### 10.10 ReferÃªncias TÃ©cnicas

**Tailwind CSS v4:**
- [Theme Variables - @theme Directive](https://tailwindcss.com/docs/theme)
- [Dark Mode Configuration](https://tailwindcss.com/docs/dark-mode)
- [Functions and Directives](https://tailwindcss.com/docs/functions-and-directives)
- [Tailwind CSS v4.0 Announcement](https://tailwindcss.com/blog/tailwindcss-v4)

**Design System Premium:**
- [shadcn/ui Tailwind v4 Guide](https://ui.shadcn.com/docs/tailwind-v4)
- [Multi-Theme with Tailwind v4](https://medium.com/render-beyond/build-a-flawless-multi-theme-ui-using-new-tailwind-css-v4-react-dca2b3c95510)

**Acessibilidade:**
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [WAI-ARIA Authoring Practices](https://www.w3.org/WAI/ARIA/apg/)

---

### FASE 11: BENCHMARK & PERFORMANCE OPTIMIZATION (Sprint 13-14)
**Objetivo:** Garantir que Genesis OS seja o software de clÃ­nica mÃ©dica mais rÃ¡pido e eficiente do mercado
**Status:** ğŸŸ¡ EM PLANEJAMENTO (Audit concluÃ­do 23/12/2024)
**Prioridade:** ğŸ”´ CRÃTICA

> **VISÃƒO:** Performance Ã© feature. Cada milissegundo conta na experiÃªncia do usuÃ¡rio.
> Um software lento transmite falta de profissionalismo. Queremos ser REFERÃŠNCIA em velocidade.
>
> **"Performance isn't just about speed - it's about respect for your users' time"** - Addy Osmani

---

#### 11.0 ğŸ” AUDIT BRUTAL - DIAGNÃ“STICO REAL (23/12/2024)

##### O QUE ESTÃ BOM âœ…
| Ãrea | Status | EvidÃªncia |
|------|--------|-----------|
| Lazy Loading de Rotas | âœ… Implementado | `src/routes/` usa `React.lazy()` com Suspense |
| Code Splitting | âœ… Parcial | Rotas separadas, mas vendor bundle ainda grande |
| Cleanup de Effects | âœ… Correto | `useFirestoreSubscription` retorna unsubscribe |
| Skeleton Loading | âœ… Consistente | Design system com `<Skeleton />` |
| Debounce em Search | âœ… Implementado | `useDebouncedCallback` em buscas |

##### O QUE ESTÃ RUIM âŒ (PROBLEMAS IDENTIFICADOS)

| Problema | Arquivo | Linha | Impacto | SoluÃ§Ã£o |
|----------|---------|-------|---------|---------|
| **8 filter iterations** por render | `useDashboardMetrics.ts` | 191-321 | CPU spike a cada render | Single-pass aggregation |
| **Inline .filter/.sort** em JSX | `Agenda.tsx` | 69-125 | Re-cÃ¡lculo em cada render | `useMemo` |
| **Bundle 888KB** carregado eager | `vite.config.ts` | export-vendor | TTI +2-3s | Dynamic import |
| **Sem paginaÃ§Ã£o** Firestore | `usePatients.ts` | * | 500+ docs loaded | `limit(100)` + cursor |
| **5 Context providers** aninhados | `App.tsx` | root | Re-render cascade | Context splitting |
| **useMemo ausentes** em cÃ¡lculos | `DashboardPage.tsx` | metrics | Re-cÃ¡lculo desnecessÃ¡rio | Memoization |
| **Listas sem virtualizaÃ§Ã£o** | `PatientList.tsx` | render | DOM bloat 1000+ nodes | TanStack Virtual |
| **Real-time listeners** excessivos | `useFirestoreSubscription` | * | Reads $$ + bandwidth | Batch/poll hÃ­brido |

##### BUNDLES ATUAIS (vite build)
```
export-vendor.js    888 KB  âš ï¸ CRÃTICO - PDF/Excel libs
vendor.js           450 KB  âš ï¸ ALTO - React + Firebase
main.js             320 KB  âœ“ AceitÃ¡vel
```

---

#### 11.1 MÃ©tricas Core Web Vitals (Metas)

| MÃ©trica | DescriÃ§Ã£o | Atual* | Meta | Ferramenta |
|---------|-----------|--------|------|------------|
| **LCP** | Largest Contentful Paint | ~3.5s | < 2.5s | Lighthouse |
| **INP** | Interaction to Next Paint | ~250ms | < 200ms | Lighthouse |
| **CLS** | Cumulative Layout Shift | ~0.15 | < 0.1 | Lighthouse |
| **TTFB** | Time to First Byte | ~400ms | < 600ms | WebPageTest |
| **FCP** | First Contentful Paint | ~2.2s | < 1.8s | Lighthouse |
| **TTI** | Time to Interactive | ~5.0s | < 3.8s | Lighthouse |

*Estimativas baseadas no audit - medir com Lighthouse CI

---

#### 11.2 Bundle Optimization (WEB RESEARCH 2025)

> **Fonte:** [Vite Build Options 2025](https://vite.dev/config/build-options) | [Bundle Splitting Deep Dive](https://briandouglas.me/posts/2025/08/23/optimizing-bundle-splitting/)

##### 11.2.1 AÃ‡ÃƒO CRÃTICA: Dynamic Import do Export Bundle (888KB)

**Problema:** O bundle `export-vendor.js` (888KB) contÃ©m PDF/Excel libs carregados SEMPRE, mesmo que usuÃ¡rio nunca exporte.

```typescript
// âŒ ATUAL - src/utils/export.ts
import * as XLSX from 'xlsx';
import jsPDF from 'jspdf';

// âœ… SOLUÃ‡ÃƒO - Dynamic imports
export const exportToExcel = async (data: unknown[]) => {
  const XLSX = await import('xlsx');
  // ...
};

export const exportToPDF = async (data: unknown[]) => {
  const { default: jsPDF } = await import('jspdf');
  // ...
};
```

**Impacto esperado:** -888KB no bundle inicial, TTI -2s

- [ ] **11.2.1** Converter `xlsx` para dynamic import em `src/utils/export.ts`
- [ ] **11.2.2** Converter `jspdf` para dynamic import
- [ ] **11.2.3** Adicionar loading spinner no botÃ£o de export
- [ ] **11.2.4** Testar export em produÃ§Ã£o apÃ³s mudanÃ§a

##### 11.2.2 Configurar manualChunks Otimizado (Vite 2025)

```typescript
// vite.config.ts - PROPOSTA
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-core': ['react', 'react-dom', 'react-router-dom'],
          'firebase': ['firebase/app', 'firebase/auth', 'firebase/firestore'],
          'charts': ['recharts'],
          'ui': ['@radix-ui/react-dialog', '@radix-ui/react-dropdown-menu'],
          // export-vendor serÃ¡ eliminado com dynamic imports
        }
      }
    }
  }
});
```

- [ ] **11.2.5** Implementar `manualChunks` no vite.config.ts
- [ ] **11.2.6** Separar Firebase em chunk prÃ³prio (lazy load em auth)
- [ ] **11.2.7** Separar Recharts (sÃ³ carrega em Dashboard/Reports)

##### 11.2.3 Tree Shaking & Cherry-Pick Imports

```typescript
// âŒ ERRADO - Importa tudo
import { Button, Input, Select, Dialog, ... } from '@radix-ui/themes';

// âœ… CERTO - Cherry-pick
import { Button } from '@radix-ui/react-button';
import { Input } from '@radix-ui/react-input';
```

- [ ] **11.2.8** Audit de imports `*` no codebase
- [ ] **11.2.9** Cherry-pick imports de lucide-react (sÃ³ Ã­cones usados)
- [ ] **11.2.10** Configurar `sideEffects: false` em package.json

##### 11.2.4 SubstituiÃ§Ãµes de DependÃªncias Pesadas

| Atual | Tamanho | Alternativa | Economia |
|-------|---------|-------------|----------|
| date-fns (se full) | ~75KB | date-fns/esm cherry-pick | -60KB |
| lodash (se full) | ~70KB | lodash-es cherry-pick | -60KB |
| xlsx | ~500KB | SheetJS mini ou dynamic | -500KB |

- [ ] **11.2.11** Verificar se lodash Ã© usado (se sim, cherry-pick)
- [ ] **11.2.12** Verificar imports de date-fns (cherry-pick se necessÃ¡rio)

---

#### 11.3 Runtime Performance (WEB RESEARCH 2025)

> **Fonte:** [React 19 Compiler](https://react.dev/learn/react-compiler) | [TanStack Virtual](https://tanstack.com/virtual/latest) | [React Scan](https://github.com/aidenybai/react-scan)

##### 11.3.1 AÃ‡ÃƒO CRÃTICA: Fix useDashboardMetrics (8 iteraÃ§Ãµes â†’ 1)

**Problema atual em `src/hooks/useDashboardMetrics.ts:191-321`:**
```typescript
// âŒ ATUAL - 8 filter passes separados
const pending = appointments.filter(a => a.status === 'pending');
const confirmed = appointments.filter(a => a.status === 'confirmed');
const cancelled = appointments.filter(a => a.status === 'cancelled');
const today = appointments.filter(a => isToday(a.date));
// ... mais 4 filters
```

**SoluÃ§Ã£o - Single-pass aggregation:**
```typescript
// âœ… OTIMIZADO - 1 pass com reduce
const metrics = useMemo(() => {
  return appointments.reduce((acc, apt) => {
    acc.total++;
    acc[apt.status] = (acc[apt.status] || 0) + 1;
    if (isToday(apt.date)) acc.today++;
    if (apt.revenue) acc.revenue += apt.revenue;
    return acc;
  }, { total: 0, pending: 0, confirmed: 0, cancelled: 0, today: 0, revenue: 0 });
}, [appointments]);
```

- [ ] **11.3.1** Refatorar `useDashboardMetrics.ts` para single-pass
- [ ] **11.3.2** Adicionar `useMemo` no aggregation
- [ ] **11.3.3** Benchmark antes/depois com React Profiler

##### 11.3.2 Fix Inline Filters em Agenda.tsx

**Problema em `src/pages/Agenda.tsx:69-125`:**
```typescript
// âŒ ATUAL - Recalcula em cada render
return (
  <div>
    {appointments.filter(a => a.date === selectedDate).sort((a, b) => ...)}
  </div>
);
```

**SoluÃ§Ã£o:**
```typescript
// âœ… OTIMIZADO
const filteredAppointments = useMemo(() =>
  appointments
    .filter(a => a.date === selectedDate)
    .sort((a, b) => a.time.localeCompare(b.time)),
  [appointments, selectedDate]
);
```

- [ ] **11.3.4** Extrair filters inline para `useMemo` em `Agenda.tsx`
- [ ] **11.3.5** Fazer o mesmo em `DashboardPage.tsx`
- [ ] **11.3.6** Audit de outros componentes com .filter/.sort inline

##### 11.3.3 VirtualizaÃ§Ã£o de Listas Longas (TanStack Virtual)

**Problema:** `PatientList.tsx` renderiza 500+ items, criando 2000+ DOM nodes.

```typescript
// âœ… SOLUÃ‡ÃƒO com @tanstack/react-virtual
import { useVirtualizer } from '@tanstack/react-virtual';

const PatientList = ({ patients }) => {
  const parentRef = useRef(null);
  const virtualizer = useVirtualizer({
    count: patients.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 72, // altura do item
    overscan: 5,
  });

  return (
    <div ref={parentRef} style={{ height: '600px', overflow: 'auto' }}>
      <div style={{ height: virtualizer.getTotalSize() }}>
        {virtualizer.getVirtualItems().map(virtualRow => (
          <PatientCard key={patients[virtualRow.index].id} {...} />
        ))}
      </div>
    </div>
  );
};
```

**Impacto:** De 2000+ nodes para ~20 nodes visÃ­veis. 60 FPS garantido.

- [ ] **11.3.7** Instalar `@tanstack/react-virtual`
- [ ] **11.3.8** Implementar em `PatientList.tsx`
- [ ] **11.3.9** Implementar em lista de appointments
- [ ] **11.3.10** Testar scroll performance com React Profiler

##### 11.3.4 Context Splitting (Evitar Re-render Cascade)

**Problema em `App.tsx`:** 5 providers aninhados causam re-renders em cascata.

```typescript
// âŒ ATUAL
<AuthProvider>
  <ClinicProvider>
    <PageProvider>
      <ThemeProvider>
        <ToastProvider>
          {children}
        </ToastProvider>
      </ThemeProvider>
    </PageProvider>
  </ClinicProvider>
</AuthProvider>
```

**SoluÃ§Ã£o:** Separar contexts que mudam frequentemente dos estÃ¡veis.

- [ ] **11.3.11** Audit de re-renders com `why-did-you-render`
- [ ] **11.3.12** Separar `PageContext` (muda frequente) dos outros
- [ ] **11.3.13** Considerar `use-context-selector` para granularidade

##### 11.3.5 React 19 Compiler (FUTURO - Quando EstÃ¡vel)

> **Nota:** React Compiler (v19) auto-memoiza componentes, eliminando necessidade de
> `useMemo`, `useCallback`, `React.memo` manuais. Monitorar para adoÃ§Ã£o em 2025.

- [ ] **11.3.14** Testar React Compiler em branch experimental
- [ ] **11.3.15** Documentar compatibilidade com cÃ³digo atual

---

#### 11.4 Network & Caching (WEB RESEARCH 2025)

> **Fonte:** [Firestore Best Practices](https://firebase.google.com/docs/firestore/best-practices) | [Real-time Queries at Scale](https://firebase.google.com/docs/firestore/real-time_queries_at_scale)

##### 11.4.1 AÃ‡ÃƒO CRÃTICA: PaginaÃ§Ã£o Firestore

**Problema:** `usePatients.ts` carrega TODOS os pacientes (500+) de uma vez.

```typescript
// âŒ ATUAL - Carrega tudo
const q = query(collection(db, 'patients'), where('clinicId', '==', clinicId));

// âœ… OTIMIZADO - Cursor pagination
const q = query(
  collection(db, 'patients'),
  where('clinicId', '==', clinicId),
  orderBy('createdAt', 'desc'),
  limit(50)
);

// Load more com cursor
const loadMore = async (lastDoc) => {
  const next = query(
    collection(db, 'patients'),
    where('clinicId', '==', clinicId),
    orderBy('createdAt', 'desc'),
    startAfter(lastDoc),
    limit(50)
  );
};
```

**Impacto:** -90% reads iniciais, -70% bandwidth, faster initial load

- [ ] **11.4.1** Implementar `limit(50)` em `usePatients.ts`
- [ ] **11.4.2** Adicionar `startAfter` cursor para load more
- [ ] **11.4.3** Implementar infinite scroll com intersection observer
- [ ] **11.4.4** Repetir para `useAppointments.ts`

##### 11.4.2 OtimizaÃ§Ã£o de Real-time Listeners

**Problema:** Listeners ativos em dados que raramente mudam aumentam custos.

```typescript
// âŒ Real-time para tudo
const { data: settings } = useFirestoreSubscription('clinicSettings');

// âœ… Real-time SÃ“ para dados que mudam frequentemente
// Settings: GET once (muda raramente)
const settings = await getDoc(doc(db, 'clinicSettings', clinicId));

// Appointments do dia: Real-time (muda frequente)
const { data: todayAppointments } = useFirestoreSubscription(
  query(appointments, where('date', '==', today))
);
```

**Regra:** Real-time para dados que mudam em minutos. GET para dados que mudam em dias.

- [ ] **11.4.5** Audit de todos `useFirestoreSubscription`
- [ ] **11.4.6** Converter settings/configs para `getDoc()` cached
- [ ] **11.4.7** Manter real-time sÃ³ para: appointments, chat, notifications

##### 11.4.3 Composite Indexes

**Queries complexas precisam de indexes para performance:**

```
// firestore.indexes.json
{
  "indexes": [
    {
      "collectionGroup": "appointments",
      "fields": [
        { "fieldPath": "clinicId", "order": "ASCENDING" },
        { "fieldPath": "date", "order": "DESCENDING" },
        { "fieldPath": "status", "order": "ASCENDING" }
      ]
    }
  ]
}
```

- [ ] **11.4.8** Criar index para appointments (clinicId + date + status)
- [ ] **11.4.9** Criar index para patients (clinicId + name)
- [ ] **11.4.10** Deploy indexes com `firebase deploy --only firestore:indexes`

##### 11.4.4 Offline Persistence & Caching

```typescript
// âœ… Habilitar persistence (jÃ¡ deve estar)
import { enableIndexedDbPersistence } from 'firebase/firestore';
enableIndexedDbPersistence(db);

// âœ… Cache hints para queries frequentes
const q = query(
  collection(db, 'patients'),
  where('clinicId', '==', clinicId)
).withConverter(patientConverter);
```

- [ ] **11.4.11** Verificar se `enableIndexedDbPersistence` estÃ¡ ativo
- [ ] **11.4.12** Implementar converters para type safety + cache efficiency

##### 11.4.5 Traffic Ramping (500/50/5 Rule)

> **IMPORTANTE:** Para novas collections, seguir regra Firebase:
> - MÃ¡x 500 ops/s iniciais
> - Aumentar 50% a cada 5 minutos
> - Nunca picos sÃºbitos em collections novas

- [ ] **11.4.13** Documentar rule para novas collections
- [ ] **11.4.14** Implementar rate limiting em batch operations

---

#### 11.5 Cloud Functions Optimization

##### 11.5.1 Cold Start Reduction
- [ ] **11.5.1** Manter funÃ§Ãµes crÃ­ticas "warm" com scheduled pings
- [ ] **11.5.2** Minimizar dependÃªncias em cada funÃ§Ã£o
- [ ] **11.5.3** Usar imports dinÃ¢micos dentro das funÃ§Ãµes

##### 11.5.2 Execution Time
- [ ] **11.5.4** Paralelizar operaÃ§Ãµes independentes com Promise.all
- [ ] **11.5.5** Implementar connection pooling para external APIs
- [ ] **11.5.6** Cache de dados frequentes (in-memory ou Redis)

##### 11.5.3 Memory & Scaling
- [ ] **11.5.7** Ajustar memory allocation por funÃ§Ã£o (256MB-1GB)
- [ ] **11.5.8** Configurar minInstances para funÃ§Ãµes crÃ­ticas
- [ ] **11.5.9** Implementar rate limiting para proteÃ§Ã£o

---

#### 11.6 Monitoring & Benchmarking

##### 11.6.1 Ferramentas de AnÃ¡lise
- [ ] **11.6.1** Configurar Lighthouse CI no pipeline
- [ ] **11.6.2** Implementar Web Vitals tracking (analytics)
- [ ] **11.6.3** Configurar Firebase Performance Monitoring
- [ ] **11.6.4** Criar dashboard de mÃ©tricas de performance

##### 11.6.2 Benchmarks Comparativos
- [ ] **11.6.5** Benchmark vs SimplePractice
- [ ] **11.6.6** Benchmark vs DrChrono
- [ ] **11.6.7** Benchmark vs Jane App
- [ ] **11.6.8** Documentar resultados e gaps

##### 11.6.3 Regression Prevention
- [ ] **11.6.9** Configurar bundle size budget
- [ ] **11.6.10** Alertas para degradaÃ§Ã£o de Core Web Vitals
- [ ] **11.6.11** Performance tests em CI/CD

---

#### 11.7 ğŸš€ PLANO DE EXECUÃ‡ÃƒO HEROICO (Ordem de Impacto)

##### SPRINT 1: QUICK WINS DE ALTO IMPACTO (ğŸ”´ CRÃTICO)
**Meta:** -50% bundle size, -2s TTI

| # | AÃ§Ã£o | Arquivo | Impacto Esperado |
|---|------|---------|------------------|
| 1 | Dynamic import xlsx/jspdf | `src/utils/export.ts` | -888KB bundle |
| 2 | useMemo em useDashboardMetrics | `src/hooks/useDashboardMetrics.ts` | -80% CPU |
| 3 | limit(50) em queries | `usePatients.ts`, `useAppointments.ts` | -90% reads |
| 4 | useMemo filters Agenda | `src/pages/Agenda.tsx` | -70% re-renders |

- [x] **SPRINT1.1** Lighthouse baseline audit (documentar nÃºmeros) âœ…
- [x] **SPRINT1.2** Dynamic import das libs de export âœ… (export.service.ts)
- [x] **SPRINT1.3** Single-pass aggregation em useDashboardMetrics âœ… (12 filters â†’ 1 loop)
- [ ] **SPRINT1.4** PaginaÃ§Ã£o Firestore (limit + cursor) - Requer mudanÃ§as de arquitetura
- [x] **SPRINT1.5** useMemo em Dashboard.tsx âœ… (upcomingAppointments)

##### SPRINT 2: VIRTUALIZAÃ‡ÃƒO & MEMOIZATION (ğŸŸ¡ ALTA)
**Meta:** 60 FPS em listas, zero lag em scroll

| # | AÃ§Ã£o | Arquivo | Impacto Esperado |
|---|------|---------|------------------|
| 1 | TanStack Virtual | `PatientList.tsx` | -95% DOM nodes |
| 2 | TanStack Virtual | Lista de appointments | -95% DOM nodes |
| 3 | manualChunks config | `vite.config.ts` | Parallel loading |
| 4 | Context splitting | `App.tsx` | -50% re-renders |

- [x] **SPRINT2.1** Instalar @tanstack/react-virtual âœ…
- [x] **SPRINT2.2** Implementar virtualizaÃ§Ã£o em PatientList âœ… (Patients.tsx)
- [ ] **SPRINT2.3** Implementar virtualizaÃ§Ã£o em AppointmentList - Futuro
- [x] **SPRINT2.4** Configurar manualChunks no Vite âœ… (6 vendor chunks)
- [ ] **SPRINT2.5** Audit re-renders com why-did-you-render - Futuro

##### SPRINT 3: NETWORK & FIRESTORE (ğŸŸ¢ MÃ‰DIO) âœ… COMPLETO
**Meta:** -70% Firestore costs, offline-first

| # | AÃ§Ã£o | Arquivo | Impacto Esperado |
|---|------|---------|------------------|
| 1 | Real-time â†’ GET para configs | `ClinicContext.tsx` | -80% listeners âœ… |
| 2 | Composite indexes | `firestore.indexes.json` | -50% query time (futuro) |
| 3 | Offline persistence | `firebase.ts` | Instant load âœ… |
| 4 | Cherry-pick imports | `*.tsx` | N/A - tree-shaking jÃ¡ otimizado |

- [x] **SPRINT3.1** Audit todos useFirestoreSubscription âœ…
- [x] **SPRINT3.2** Converter ClinicContext para getDoc cached âœ…
- [ ] **SPRINT3.3** Criar composite indexes - Futuro (requer anÃ¡lise de queries)
- [x] **SPRINT3.4** Habilitar IndexedDB persistence (persistentLocalCache) âœ…
- [x] **SPRINT3.5** Cherry-pick lucide - N/A (tree-shaking OK, 31KB gzip)

##### SPRINT 4: MONITORING & GUARD RAILS (ğŸŸ¢ MÃ‰DIO) âœ… COMPLETO
**Meta:** Zero regression, alerts automÃ¡ticos

- [x] **SPRINT4.1** Configurar Lighthouse CI no GitHub Actions âœ…
- [x] **SPRINT4.2** Bundle size budget (fail if > 1.5MB) âœ…
- [x] **SPRINT4.3** Web Vitals tracking (web-vitals package) âœ…
- [ ] **SPRINT4.4** Benchmark vs concorrentes - Futuro (opcional)
- [x] **SPRINT4.5** Documentar resultados finais âœ…

---

#### 11.8 MÃ©tricas de Sucesso

| MÃ©trica | Baseline (Est.) | Meta | Impacto Business |
|---------|-----------------|------|------------------|
| Lighthouse Performance | ~65 | **> 90** | SEO + UX |
| Bundle Size (initial) | ~1.6MB | **< 800KB** | -50% load time |
| Bundle Size (export) | 888KB | **0KB (lazy)** | -2s TTI |
| Time to Interactive | ~5.0s | **< 3s** | -40% bounce |
| First Contentful Paint | ~2.2s | **< 1.5s** | Perceived speed |
| Firestore reads/user/day | ~500 | **< 150 (-70%)** | -70% costs |
| DOM Nodes (listas) | ~2000 | **< 50** | 60 FPS scroll |
| Re-renders/interaction | ~15 | **< 5** | Smooth UX |

---

#### 11.9 ReferÃªncias TÃ©cnicas (PESQUISA WEB DEZ/2025)

**React Performance 2025:**
- [React 19 Compiler](https://react.dev/learn/react-compiler) - Auto-memoizaÃ§Ã£o
- [TanStack Virtual](https://tanstack.com/virtual/latest) - VirtualizaÃ§Ã£o de listas
- [React Scan](https://github.com/aidenybai/react-scan) - Debug de renders
- [why-did-you-render](https://github.com/welldone-software/why-did-you-render) - Re-render tracking

**Vite & Bundle 2025:**
- [Vite Build Options](https://vite.dev/config/build-options) - manualChunks
- [Bundle Splitting Deep Dive](https://briandouglas.me/posts/2025/08/23/optimizing-bundle-splitting/)
- [Taming Large Chunks Vite](https://www.mykolaaleksandrov.dev/posts/2025/11/taming-large-chunks-vite-react/)

**Firebase Performance 2025:**
- [Firestore Best Practices](https://firebase.google.com/docs/firestore/best-practices)
- [Real-time Queries at Scale](https://firebase.google.com/docs/firestore/real-time_queries_at_scale)
- [Firestore Query Performance](https://estuary.dev/blog/firestore-query-best-practices/)
- [Pagination with Real-time](https://medium.com/firebase-tips-tricks/how-to-create-a-clean-firestore-pagination-with-real-time-updates-ce05a87bb902)

**Tools:**
- [rollup-plugin-visualizer](https://github.com/btd/rollup-plugin-visualizer)
- [Lighthouse CI](https://github.com/GoogleChrome/lighthouse-ci)

---

## CRONOGRAMA E PROGRESSO

| Fase | Status | Prioridade |
|------|--------|------------|
| Fase 1: FundaÃ§Ã£o Premium | âœ… COMPLETO (22/12/2024) | ğŸ”´ CRÃTICA |
| Fase 2: ExperiÃªncia Paciente | âœ… COMPLETO (22/12/2024) | ğŸ”´ CRÃTICA |
| Fase 3: DocumentaÃ§Ã£o AI | âœ… COMPLETO (22/12/2024) | ğŸŸ¡ ALTA |
| Fase 4: Design System | âœ… COMPLETO (22/12/2024) | ğŸŸ¡ ALTA |
| Fase 5: Analytics | âœ… COMPLETO (22/12/2024) | ğŸŸ¢ MÃ‰DIA |
| Fase 6: WhatsApp Business API | âœ… COMPLETO (22/12/2024) | ğŸ”´ CRÃTICA |
| Fase 7: Portal do Paciente | âœ… COMPLETO (22/12/2024) | ğŸ”´ CRÃTICA |
| Fase 8: ConvÃªnios/TISS - PESQUISA | âœ… PESQUISA COMPLETA (22/12/2024) | ğŸ”´ CRÃTICA |
| Fase 8b: ConvÃªnios/TISS - IMPLEMENTAÃ‡ÃƒO | âœ… COMPLETO (23/12/2024) | ğŸ”´ CRÃTICA |
| Fase 9: Workflow Automation | âœ… COMPLETO (23/12/2024) | ğŸŸ¡ ALTA |
| **Fase 10: UI/UX Premium Polish** | **âœ… 100% COMPLETO (23/12/2024)** | **ğŸ”´ CRÃTICA** |
| **Fase 11: Benchmark & Performance** | **ğŸŸ¡ PLANEJAMENTO COMPLETO (23/12/2024)** | **ğŸ”´ CRÃTICA** |

**Progresso Geral:** 11/12 fases completas (92%) - FASE 11 pronta para execuÃ§Ã£o

> âœ… **FASE 8 PESQUISA CONCLUÃDA:** Documento completo em `docs/research/CONVENIOS_TISS_RESEARCH.md`
> Inclui: legislaÃ§Ã£o ANS, padrÃ£o TISS 4.01, TUSS, certificaÃ§Ã£o ICP-Brasil, requisitos de 7 operadoras
> (UNIMED, GEAP, CASSI, Postal SaÃºde, Amil, Bradesco, SulAmÃ©rica), arquitetura proposta e roadmap.
>
> âœ… **FASE 8b COMPLETA (23/12/2024):**
> - âœ… ETAPA 1-4: Infraestrutura, Settings, Guias, GestÃ£o (Frontend completo)
> - âœ… ETAPA 5: Cloud Functions TISS (encryption, certificate, xml-signer, lote, sender)
> - âœ… ETAPA 6: Recebimento de Respostas (response-handler, glosa-triggers, demonstrativo-parser)
> - âœ… ETAPA 7: Recurso de Glosa (createRecurso, sendRecurso, recurso-xml)
> - âœ… ETAPA 8: RelatÃ³rios e Analytics (GlosasAnalysis, ReportsTab, export utilities)
>
> âœ… **FASE 9 COMPLETA (23/12/2024):**
> - âœ… Follow-up PÃ³s-Consulta (sendFollowUpMessages)
> - âœ… Pesquisa NPS (sendNPSSurveys, npsResponseWebhook, calculateNPSScore)
> - âœ… Lembrete de Retorno (sendPatientReturnReminders)
> - âœ… IntegraÃ§Ã£o Labs (labsResultWebhook)
> - âœ… UI de ConfiguraÃ§Ã£o (WorkflowSettings.tsx, nova tab em Settings)
> - âœ… Testes: 138 Cloud Functions + 1225 Frontend = **1363 tests**
> - âœ… CODE_CONSTITUTION: ValidaÃ§Ã£o completa (todos arquivos < 500 linhas)
>
> âœ… **FASE 10 COMPLETA (23/12/2024) - 100%:**
> - âœ… Sprint 1: Patient Portal (10 arquivos) - Dark mode tokens
> - âœ… Sprint 1: Telemedicina (4 arquivos) - Tokens semÃ¢nticos + micro-interaÃ§Ãµes
> - âœ… Sprint 2: STATUS_CONFIG (5 arquivos) - Billing, LoteCard, guia-constants, certificate-utils, ReportComponents
> - âœ… Sprint 3: Focus Rings (11 arquivos, 44 instÃ¢ncias) - focus:ring â†’ genesis-primary
> - âœ… Sprint 4: Micro-interaÃ§Ãµes (3 arquivos) - BookAppointment, TissConsultaForm, Patient Portal
> - âœ… Fix: patient-return.ts - sendTemplateMessage signature
> - âœ… Fix: tsconfig.json - ExclusÃ£o de arquivos de teste do build
> - âœ… Sprint 5: Acessibilidade ARIA (4 arquivos) - SOAPReview, ClinicalReasoningPanel, ProfessionalSelector, LabUploadPanel
> - âœ… Sprint 6: Responsividade grids (2 arquivos) - GuiaDetail, LoteCard
>
> âœ… **VALIDAÃ‡ÃƒO CODE_CONSTITUTION (23/12/2024):**
> - âœ… Lint: **0 erros** (corrigidos 7: Function types, letâ†’const, unused imports)
> - âœ… TypeCheck: **Pass** (tsc --noEmit)
> - âœ… Build: **Success** (10.45s)
> - âœ… Coverage: **94.74%** (Required â‰¥80%, Excellent â‰¥90%)
> - âœ… Novos testes: **58 adicionados** (Progress.tsx 46, SkipLink.tsx 12)
> - âœ… LotesTab coverage: handleSendLote/handleDeleteLote, callbacks
> - âœ… Vitest config: ExclusÃ£o de type-only files do coverage
>
> ğŸŸ¡ **FASE 11 PLANEJAMENTO COMPLETO (23/12/2024):**
> - âœ… Deep audit da arquitetura e fluxos de dados
> - âœ… IdentificaÃ§Ã£o de 8 problemas crÃ­ticos de performance
> - âœ… Web Research dezembro/2025 (React 19, Firebase, Vite, TanStack)
> - âœ… Plano de execuÃ§Ã£o HEROICO em 4 sprints
> - âœ… MÃ©tricas e metas definidas (Lighthouse >90, bundle -50%, reads -70%)
>
> âœ… **FASE 11 SPRINT 1 - COMPLETO (23/12/2024):**
> - âœ… Dynamic imports para xlsx/jspdf (bundle lazy load)
> - âœ… Single-pass aggregation em useDashboardMetrics (12 filters â†’ 1 loop)
> - âœ… useMemo em Dashboard.tsx (upcomingAppointments)
> - â³ PaginaÃ§Ã£o Firestore (requer mudanÃ§as de arquitetura - Sprint futuro)
>
> âœ… **FASE 11 SPRINT 2 - COMPLETO (23/12/2024):**
> - âœ… @tanstack/react-virtual instalado
> - âœ… Patients.tsx virtualizado (2000+ DOM nodes â†’ ~50 visÃ­veis)
> - âœ… manualChunks otimizado (6 vendor chunks separados)
>   - react-vendor: 354KB | firebase-vendor: 517KB | charts-vendor: 513KB
>   - utils-vendor: 31KB | export-vendor: 1MB (lazy) | index: 114KB
>
> âœ… **FASE 11 SPRINT 3 - COMPLETO (23/12/2024):**
> - âœ… IndexedDB persistence habilitado (persistentLocalCache)
>   - Instant cache hits em todas as queries
>   - Suporte offline completo
>   - SincronizaÃ§Ã£o multi-tab
>   - Cache ilimitado para clÃ­nicas grandes
> - âœ… ClinicContext convertido de subscribe para getDoc
>   - Elimina 2 listeners ativos por sessÃ£o de usuÃ¡rio
>   - Refresh automÃ¡tico apÃ³s mutations
>   - Adicionada funÃ§Ã£o refreshUserProfile
> - âœ… Testes atualizados (1225 tests passando)
> - **Impacto:** ~80% reduÃ§Ã£o em custos de Firestore listeners
>
> âœ… **FASE 11 SPRINT 4 - COMPLETO (23/12/2024):**
> - âœ… GitHub Actions CI/CD configurado (.github/workflows/ci.yml)
>   - Quality checks: typecheck, lint, tests
>   - Bundle size budget (fail if > 1500KB initial)
>   - Lighthouse CI com thresholds de performance
> - âœ… Lighthouse CI configurado (lighthouserc.json)
>   - Performance > 85%, Accessibility > 90%
>   - LCP < 3s, CLS < 0.1, TBT < 300ms
> - âœ… Web Vitals tracking implementado (web-vitals.ts)
>   - LCP, INP, CLS, FCP, TTFB tracking
>   - Console logging em dev, analytics-ready em prod
> - âœ… 1225 tests passando
>
> ğŸ‰ **FASE 11 COMPLETA - Performance Optimization Heroico!**

---

## REFERÃŠNCIAS

### Plataformas Analisadas
- [Epic MyChart Best in KLAS 2025](https://www.techtarget.com/PatientEngagement/news/366618817/Epic-leads-2025-Best-in-KLAS-for-MyChart-patient-portal)
- [SimplePractice Features](https://www.simplepractice.com/features/)
- [Jane App Review 2025](https://www.medesk.net/en/blog/jane-app-review/)
- [Klara Patient Communication](https://www.klara.com/)
- [Elation Health AI Features](https://www.elationhealth.com/)
- [DrChrono Mobile EHR](https://www.drchrono.com/mobile-ipad-ehr-app/)
- [Carbon Health AI Charting](https://www.businesswire.com/news/home/20230605005211/en/Carbon-Health-Launches-AI-Charting)
- [Zocdoc UX Case Study](https://usabilitygeek.com/ux-case-study-zocdoc-mobile-app/)
- [Healthie Nutrition Platform](https://www.gethealthie.com/nutrition)
- [athenahealth Summer 2025](https://www.athenahealth.com/resources/blog/athenaone-summer-2025-update)

### n8n & Workflow Automation
- [n8n Official Docs](https://docs.n8n.io/)
- [n8n Healthcare Templates](https://n8n.io/workflows/?categories=Healthcare)
- [n8n Firebase Integration](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.firebase/)
- [n8n WhatsApp Integration](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.whatsapp/)
- [n8n Webhook Security](https://docs.n8n.io/hosting/security/)
- [n8n Self-Hosting Guide](https://docs.n8n.io/hosting/)

### UX/UI Design
- [Healthcare UX Trends 2025](https://www.webstacks.com/blog/healthcare-ux-design)
- [50 Healthcare UX/UI Examples](https://www.koruux.com/50-examples-of-healthcare-UI/)
- [Linear Design Trend](https://blog.logrocket.com/ux-design/linear-design/)
- [Skeleton Loading Best Practices](https://www.nngroup.com/articles/skeleton-screens/)
- [Healthcare Dashboard Design](https://www.thinkitive.com/blog/best-practices-in-healthcare-dashboard-design/)

### AI & Documentation
- [AI Ambient Scribe Guide 2025](https://www.scribehealth.ai/blog/what-is-ambient-voice-technology-a-complete-guide-for-ai-medical-scribes-in-2025)
- [Abridge Best in KLAS](https://catalyst.nejm.org/doi/full/10.1056/CAT.25.0040)

### WhatsApp Business API
- [WhatsApp for Healthcare Guide](https://www.wati.io/blog/whatsapp-for-healthcare-how-medical-institutions-can-use-it/)
- [97% mÃ©dicos Brasil usam WhatsApp](https://respond.io/blog/whatsapp-for-healthcare)

### ConvÃªnios Brasil - LegislaÃ§Ã£o e TISS (PESQUISA OBRIGATÃ“RIA)
**ANS (AgÃªncia Nacional de SaÃºde Suplementar):**
- [Portal ANS Oficial](https://www.gov.br/ans/)
- [PadrÃ£o TISS ANS](https://www.gov.br/ans/pt-br/assuntos/prestadores/padrao-tiss)
- [Terminologia TUSS](https://www.gov.br/ans/pt-br/assuntos/prestadores/tuss)
- [ResoluÃ§Ãµes Normativas](https://www.gov.br/ans/pt-br/regulacao)

**Operadoras PrioritÃ¡rias:**
- [UNIMED Brasil](https://www.unimed.coop.br/)
- [GEAP AutogestÃ£o](https://www.geap.org.br/)
- [CASSI](https://www.cassi.com.br/)

**CertificaÃ§Ã£o Digital ICP-Brasil:**
- [ITI - Instituto Nacional de TI](https://www.gov.br/iti/)
- [Certificados e-CPF/e-CNPJ](https://www.gov.br/iti/pt-br/assuntos/certificado-digital)

**Ferramentas e Cadastros:**
- [DATASUS](https://datasus.saude.gov.br/)
- [CNES - Cadastro Nacional](https://cnes.datasus.gov.br/)
- [Validador TISS](https://www.validadortiss.com.br/)

---

## RESULTADO ESPERADO

ApÃ³s implementaÃ§Ã£o completa:

### UX & Design
1. **UX Score** comparÃ¡vel a SimplePractice/Jane App/Zocdoc
2. **Onboarding** em menos de 3 minutos
3. **AÃ§Ãµes principais** em 3 taps ou menos
4. **Dark mode** 100% funcional em todas as telas
5. **Accessibility** WCAG 2.1 AA certified

### Engagement
6. **No-show rate** reduzido em 30-60% com lembretes WhatsApp
7. **NPS** acima de 60 (nÃ­vel enterprise)
8. **Patient adoption** 80%+ (benchmark Klara)

### Operacional
9. **DocumentaÃ§Ã£o** 50% mais rÃ¡pida com AI Scribe
10. **Faturamento TISS** automatizado e compliant ANS
11. **Portal do paciente** self-service completo

### TÃ©cnico
12. **Zero console.logs** em produÃ§Ã£o
13. **TypeScript strict** sem erros
14. **Design tokens** 100% consistentes
15. **Mobile-first** responsive em todos dispositivos

---

*"No matter how much power we put into it, it needs to be EASY"* - Epic Systems

*"A design is only a reference, never any deliverable itself"* - Karri Saarinen, Linear
